var e=Object.defineProperty,t=(t,i,a)=>((t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a)(t,"symbol"!=typeof i?i+"":i,a);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const i={token:null,isAuthenticated:!1,userLimits:null,formData:{category:"",subcategory:null,condition:null,title:"",description:"",price:"",negotiable:!1,contact:"",location:null,dynamicFields:{},scheduledTime:null},photos:[],uploadingCount:0,currentView:"form",isLoading:!1,error:null,currentSubcategories:null,currentConditions:null,currentDynamicFields:null};const a=new class{constructor(){t(this,"state",{...i}),t(this,"listeners",new Set)}getState(){return this.state}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}setState(e){this.state={...this.state,...e},this.notify()}setToken(e){this.setState({token:e,isAuthenticated:!!e})}setUserLimits(e){this.setState({userLimits:e})}updateFormData(e){this.setState({formData:{...this.state.formData,...e}})}setDynamicField(e,t){this.setState({formData:{...this.state.formData,dynamicFields:{...this.state.formData.dynamicFields,[e]:t}}})}clearDynamicFields(){this.setState({formData:{...this.state.formData,dynamicFields:{}}})}setLocation(e){this.setState({formData:{...this.state.formData,location:e}})}addPhoto(e){this.setState({photos:[...this.state.photos,e]})}updatePhoto(e,t){this.setState({photos:this.state.photos.map(i=>i.id===e?{...i,...t}:i)})}removePhoto(e){this.setState({photos:this.state.photos.filter(t=>t.id!==e)})}setUploadingCount(e){this.setState({uploadingCount:e})}incrementUploading(){this.setState({uploadingCount:this.state.uploadingCount+1})}decrementUploading(){this.setState({uploadingCount:Math.max(0,this.state.uploadingCount-1)})}setCurrentView(e){this.setState({currentView:e})}setLoading(e){this.setState({isLoading:e})}setError(e){this.setState({error:e})}setCurrentSubcategories(e){this.setState({currentSubcategories:e})}setCurrentConditions(e){this.setState({currentConditions:e})}setCurrentDynamicFields(e){this.setState({currentDynamicFields:e})}reset(){this.state={...i},this.notify()}resetForm(){this.setState({formData:{...i.formData},photos:[],uploadingCount:0,currentSubcategories:null,currentConditions:null,currentDynamicFields:null})}};const s=new class{constructor(){t(this,"_tg",null),t(this,"_initialized",!1),t(this,"_mainButtonCallback",null)}get tg(){return this._tg}get isAvailable(){return null!==this._tg}get user(){return this._tg?.initDataUnsafe?.user}get initData(){return this._tg?.initData||""}get themeParams(){return this._tg?.themeParams||{}}get colorScheme(){return this._tg?.colorScheme||"light"}get mainButton(){return this._tg?.MainButton}init(){if(this._initialized)return this.isAvailable;if(this._tg=window.Telegram?.WebApp||null,this._initialized=!0,!this._tg)return!1;try{return this._tg.ready(),this._tg.expand(),this._tg.enableClosingConfirmation(),!0}catch(e){return!1}}haptic(e="light"){if(this._tg?.HapticFeedback)try{["success","error","warning"].includes(e)?this._tg.HapticFeedback.notificationOccurred(e):this._tg.HapticFeedback.impactOccurred(e)}catch(t){}}showPopup(e,t,i){this._tg?.showPopup?this._tg.showPopup({title:e,message:t,buttons:i||[{type:"ok"}]}):alert(`${e}\n\n${t}`)}showAlert(e,t){this._tg?.showAlert?this._tg.showAlert(e,t):(alert(e),t?.())}showConfirm(e,t){this._tg?.showConfirm?this._tg.showConfirm(e,t):t(confirm(e))}sendData(e){return!!this._tg?.sendData&&(this._tg.sendData(e),!0)}setupMainButton(e,t){const i=this.mainButton;if(i)try{this._mainButtonCallback&&i.offClick(this._mainButtonCallback),this._mainButtonCallback=t,i.setText(e),i.onClick(t),i.show()}catch(a){}}updateMainButton(e){const t=this.mainButton;if(t)try{void 0!==e.text&&t.setText(e.text),!0===e.enabled&&t.enable(),!1===e.enabled&&t.disable(),!0===e.visible&&t.show(),!1===e.visible&&t.hide(),!0===e.progress&&t.showProgress(!0),!1===e.progress&&t.hideProgress(),e.color&&(t.color=e.color)}catch(i){}}enableClosingConfirmation(){try{this._tg?.enableClosingConfirmation()}catch(e){}}disableClosingConfirmation(){try{this._tg?.disableClosingConfirmation()}catch(e){}}},n={apiUrl:"https://your-api-domain.com/api",yandexMapsKey:"0ea443fd-4bed-4404-a064-f2202a8de835",maxPhotos:5,maxFileSize:5242880,maxDataSize:4e4,minTitleLength:3,maxTitleLength:100,minDescLength:10,maxDescLength:1e3,defaultMapCenter:[43.024615,44.681767],uploadRetryCount:2,uploadRetryDelay:1e3,apiTimeout:3e4,debug:!1};const l=new class{constructor(){t(this,"baseUrl"),t(this,"timeout"),this.baseUrl=n.apiUrl,this.timeout=n.apiTimeout}getHeaders(){const e={"Content-Type":"application/json"},t=a.getState().token;return t&&(e.Authorization=`Bearer ${t}`),e}async request(e,t,i,a){const s=new AbortController,n=setTimeout(()=>s.abort(),this.timeout);try{const n=`${this.baseUrl}${t}`,l={method:e,headers:{...this.getHeaders(),...a},signal:s.signal};i&&"GET"!==e&&(l.body=JSON.stringify(i));const o=await fetch(n,l),r=await o.json();return o.ok?{success:!0,data:r}:{success:!1,error:r.error||`HTTP ${o.status}`,code:r.code}}catch(l){return"AbortError"===l.name?{success:!1,error:"Request timeout"}:{success:!1,error:l.message||"Network error"}}finally{clearTimeout(n)}}get(e){return this.request("GET",e)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}delete(e){return this.request("DELETE",e)}},o={async authenticate(){const e=s.initData;if(!e)return!1;const t=await l.post("/auth/token",{init_data:e});return!(!t.success||!t.data)&&(a.setToken(t.data.access_token),!0)},async getUserLimits(){const e=await l.get("/user/limits");return!(!e.success||!e.data)&&(a.setUserLimits({activeSlots:e.data.active_slots,maxSlots:e.data.max_slots,availableSlots:e.data.available_slots,cooldownSeconds:e.data.cooldown_remaining_seconds||null,canPublish:e.data.can_publish,isAdmin:e.data.is_admin}),!0)},logout(){a.setToken(null),a.setUserLimits(null)}},r={"–†–∞–±–æ—Ç–∞":[{value:"–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",label:"üëî –ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},{value:"–ò—â—É_—Ä–∞–±–æ—Ç—É",label:"üíº –ò—â—É —Ä–∞–±–æ—Ç—É"},{value:"–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞",label:"‚è∞ –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞"},{value:"–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞",label:"üéì –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞"}],"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç":[{value:"–õ–µ–≥–∫–æ–≤—ã–µ",label:"üöó –õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏"},{value:"–ì—Ä—É–∑–æ–≤–∏–∫–∏",label:"üöö –ì—Ä—É–∑–æ–≤–∏–∫–∏"},{value:"–ú–æ—Ç–æ—Ü–∏–∫–ª—ã",label:"üèçÔ∏è –ú–æ—Ç–æ—Ü–∏–∫–ª—ã"},{value:"–°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞",label:"üöú –°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞"},{value:"–ó–∞–ø—á–∞—Å—Ç–∏",label:"üîß –ó–∞–ø—á–∞—Å—Ç–∏"}],"–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞":[{value:"–¢–µ–ª–µ—Ñ–æ–Ω—ã",label:"üì± –¢–µ–ª–µ—Ñ–æ–Ω—ã"},{value:"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã",label:"üíª –ö–æ–º–ø—å—é—Ç–µ—Ä—ã"},{value:"–ù–æ—É—Ç–±—É–∫–∏",label:"üíª –ù–æ—É—Ç–±—É–∫–∏"},{value:"–ü–ª–∞–Ω—à–µ—Ç—ã",label:"üì≤ –ü–ª–∞–Ω—à–µ—Ç—ã"},{value:"–¢–í_–ê—É–¥–∏–æ",label:"üì∫ –¢–í –∏ –ê—É–¥–∏–æ"},{value:"–§–æ—Ç–æ_–í–∏–¥–µ–æ",label:"üì∑ –§–æ—Ç–æ –∏ –í–∏–¥–µ–æ"},{value:"–ò–≥—Ä–æ–≤—ã–µ",label:"üéÆ –ò–≥—Ä–æ–≤—ã–µ –ø—Ä–∏—Å—Ç–∞–≤–∫–∏"}],"–û–¥–µ–∂–¥–∞":[{value:"–ñ–µ–Ω—Å–∫–∞—è",label:"üëó –ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"},{value:"–ú—É–∂—Å–∫–∞—è",label:"üëî –ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"},{value:"–û–±—É–≤—å",label:"üëü –û–±—É–≤—å"},{value:"–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",label:"üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"},{value:"–î–µ—Ç—Å–∫–∞—è",label:"üë∂ –î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"}],"–£—Å–ª—É–≥–∏":[{value:"–†–µ–º–æ–Ω—Ç",label:"üîß –†–µ–º–æ–Ω—Ç"},{value:"–ö—Ä–∞—Å–æ—Ç–∞",label:"üíá –ö—Ä–∞—Å–æ—Ç–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ"},{value:"–û–±—É—á–µ–Ω–∏–µ",label:"üìñ –û–±—É—á–µ–Ω–∏–µ"},{value:"–£–±–æ—Ä–∫–∞",label:"üßπ –£–±–æ—Ä–∫–∞"},{value:"–ü–µ—Ä–µ–≤–æ–∑–∫–∏",label:"üöö –ü–µ—Ä–µ–≤–æ–∑–∫–∏"},{value:"–î—Ä—É–≥–∏–µ",label:"‚öôÔ∏è –î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏"}]},c={"–õ–µ–≥–∫–æ–≤—ã–µ":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–ì—Ä—É–∑–æ–≤–∏–∫–∏":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–ú–æ—Ç–æ—Ü–∏–∫–ª—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞":[{value:"–ù–æ–≤–∞—è",label:"‚ú® –ù–æ–≤–∞—è"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–¢–µ–ª–µ—Ñ–æ–Ω—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ö–∞–∫_–Ω–æ–≤—ã–π",label:"‚≠ê –ö–∞–∫ –Ω–æ–≤—ã–π"},{value:"–•–æ—Ä–æ—à–µ–µ",label:"üëç –•–æ—Ä–æ—à–µ–µ"},{value:"–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ",label:"üì¶ –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ"}],"–ù–æ—É—Ç–±—É–∫–∏":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ë/–£_–æ—Ç–ª–∏—á–Ω–æ–µ",label:"‚≠ê –ë/–£ –æ—Ç–ª–∏—á–Ω–æ–µ"},{value:"–ë/–£_—Ö–æ—Ä–æ—à–µ–µ",label:"üëç –ë/–£ —Ö–æ—Ä–æ—à–µ–µ"}],"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ë/–£_–æ—Ç–ª–∏—á–Ω–æ–µ",label:"‚≠ê –ë/–£ –æ—Ç–ª–∏—á–Ω–æ–µ"},{value:"–ë/–£_—Ö–æ—Ä–æ—à–µ–µ",label:"üëç –ë/–£ —Ö–æ—Ä–æ—à–µ–µ"}]},d=new Set(["–†–∞–±–æ—Ç–∞"]),u=new Set(["–ò—â—É_—Ä–∞–±–æ—Ç—É","–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞","–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞"]),h={"–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞":{title:"üíº –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞–∫–∞–Ω—Å–∏–∏",fields:[{id:"company_sphere",label:"–°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ñ–µ—Ä—É",disabled:!0},{value:"IT",label:"üíª IT –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞"},{value:"–¢–æ—Ä–≥–æ–≤–ª—è",label:"üõí –¢–æ—Ä–≥–æ–≤–ª—è –∏ –ø—Ä–æ–¥–∞–∂–∏"},{value:"–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",label:"üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"},{value:"–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ",label:"üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"},{value:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",label:"üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},{value:"–ú–µ–¥–∏—Ü–∏–Ω–∞",label:"‚öïÔ∏è –ú–µ–¥–∏—Ü–∏–Ω–∞"},{value:"–§–∏–Ω–∞–Ω—Å—ã",label:"üí∞ –§–∏–Ω–∞–Ω—Å—ã –∏ –±–∞–Ω–∫–∏"},{value:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",label:"üìä –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞"},{value:"–õ–æ–≥–∏—Å—Ç–∏–∫–∞",label:"üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"},{value:"HoReCa",label:"üçΩÔ∏è HoReCa"},{value:"–î—Ä—É–≥–æ–µ",label:"üì¶ –î—Ä—É–≥–æ–µ"}]},{id:"work_schedule",label:"–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ü–æ–ª–Ω—ã–π_–¥–µ–Ω—å",label:"üïê –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å (5/2)"},{value:"–°–º–µ–Ω–Ω—ã–π",label:"üîÑ –°–º–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–£–¥–∞–ª–µ–Ω–Ω–∞—è",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–í–∞—Ö—Ç–∞",label:"üèóÔ∏è –í–∞—Ö—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥"},{value:"–ß–∞—Å—Ç–∏—á–Ω–∞—è",label:"‚è±Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å"}]},{id:"employment_type",label:"–£—Å–ª–æ–≤–∏—è –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",disabled:!0},{value:"–¢—Ä—É–¥–æ–≤–æ–π_–¥–æ–≥–æ–≤–æ—Ä",label:"üìã –¢—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä"},{value:"–ì–ü–•_–ò–ü",label:"üíº –î–æ–≥–æ–≤–æ—Ä –ì–ü–• —Å –ò–ü"},{value:"–ì–ü–•_–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π",label:"üìù –î–æ–≥–æ–≤–æ—Ä –ì–ü–• —Å —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–º"},{value:"–ë–µ–∑_–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",label:"ü§ù –ë–µ–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è"},{value:"–ü–æ_–¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏",label:"üí¨ –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏"}]},{id:"salary_from",label:"–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"50000",min:0},{id:"salary_to",label:"–ó–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"80000",min:0}]},"–ò—â—É_—Ä–∞–±–æ—Ç—É":{title:"üíº –û —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ",fields:[{id:"desired_position",label:"–ñ–µ–ª–∞–µ–º–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"},{id:"experience_years",label:"–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—ã—Ç",disabled:!0},{value:"–ë–µ–∑_–æ–ø—ã—Ç–∞",label:"üå± –ë–µ–∑ –æ–ø—ã—Ç–∞"},{value:"–î–æ_1_–≥–æ–¥–∞",label:"üìÖ –î–æ 1 –≥–æ–¥–∞"},{value:"1-3_–≥–æ–¥–∞",label:"üìä 1-3 –≥–æ–¥–∞"},{value:"3-5_–ª–µ—Ç",label:"‚≠ê 3-5 –ª–µ—Ç"},{value:"–ë–æ–ª–µ–µ_5_–ª–µ—Ç",label:"üèÜ –ë–æ–ª–µ–µ 5 –ª–µ—Ç"}]},{id:"desired_schedule",label:"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –≥—Ä–∞—Ñ–∏–∫",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ü–æ–ª–Ω—ã–π_–¥–µ–Ω—å",label:"üïê –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å"},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–£–¥–∞–ª–µ–Ω–Ω–∞—è",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–ß–∞—Å—Ç–∏—á–Ω–∞—è",label:"‚è±Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å"},{value:"–õ—é–±–æ–π",label:"‚ú® –õ—é–±–æ–π"}]},{id:"desired_salary_from",label:"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"50000",min:0},{id:"desired_salary_to",label:"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"100000",min:0}]},"–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞":{title:"‚è∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–µ",fields:[{id:"work_type",label:"–¢–∏–ø —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø",disabled:!0},{value:"–†–∞–∑–æ–≤–∞—è",label:"üìÖ –†–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–†–µ–≥—É–ª—è—Ä–Ω–∞—è",label:"üîÑ –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞"},{value:"–ü—Ä–æ–µ–∫—Ç–Ω–∞—è",label:"üìã –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–í–µ—á–µ—Ä–∞_–≤—ã—Ö–æ–¥–Ω—ã–µ",label:"üåô –í–µ—á–µ—Ä–∞/–≤—ã—Ö–æ–¥–Ω—ã–µ"}]},{id:"work_schedule",label:"–ì—Ä–∞—Ñ–∏–∫",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–í–µ—á–µ—Ä–∞",label:"üåô –í–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è"},{value:"–í—ã—Ö–æ–¥–Ω—ã–µ",label:"üìÖ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏"},{value:"–£–¥–∞–ª–µ–Ω–Ω–æ",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–æ"}]},{id:"payment_from",label:"–û–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"5000",min:0},{id:"payment_to",label:"–û–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"15000",min:0}]},"–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞":{title:"üéì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–µ",fields:[{id:"internship_duration",label:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",disabled:!0},{value:"1_–º–µ—Å—è—Ü",label:"üìÖ 1 –º–µ—Å—è—Ü"},{value:"2_–º–µ—Å—è—Ü–∞",label:"üìÖ 2 –º–µ—Å—è—Ü–∞"},{value:"3_–º–µ—Å—è—Ü–∞",label:"üìÖ 3 –º–µ—Å—è—Ü–∞"},{value:"6_–º–µ—Å—è—Ü–µ–≤",label:"üìÖ 6 –º–µ—Å—è—Ü–µ–≤"},{value:"–ù–µ_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",label:"‚ùì –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"}]},{id:"internship_type",label:"–¢–∏–ø —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø",disabled:!0},{value:"–û–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è",label:"üí∞ –û–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è"},{value:"–ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è",label:"üéì –ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è"},{value:"–°_–ø–æ—Å–ª–µ–¥—É—é—â–∏–º_—Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º",label:"‚úÖ –° –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º"}]},{id:"stipend_amount",label:"–†–∞–∑–º–µ—Ä —Å—Ç–∏–ø–µ–Ω–¥–∏–∏/–æ–ø–ª–∞—Ç—ã",type:"number",required:!1,placeholder:"20000",min:0}]},"–õ–µ–≥–∫–æ–≤—ã–µ":{title:"üöó –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è",fields:[{id:"car_brand",label:"–ú–∞—Ä–∫–∞",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Toyota"},{id:"car_model",label:"–ú–æ–¥–µ–ª—å",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Camry"},{id:"car_year",label:"–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞",type:"number",required:!0,placeholder:"2020",min:1950,max:(new Date).getFullYear()+1},{id:"car_mileage",label:"–ü—Ä–æ–±–µ–≥ (–∫–º)",type:"number",required:!1,placeholder:"50000",condition:"–°_–ø—Ä–æ–±–µ–≥–æ–º"},{id:"car_engine",label:"–û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ª)",type:"text",required:!1,placeholder:"2.0"},{id:"car_transmission",label:"–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –ö–ü–ü",disabled:!0},{value:"–ú–ö–ü–ü",label:"‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è"},{value:"–ê–ö–ü–ü",label:"üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è"},{value:"–†–æ–±–æ—Ç",label:"ü§ñ –†–æ–±–æ—Ç"},{value:"–í–∞—Ä–∏–∞—Ç–æ—Ä",label:"‚ö° –í–∞—Ä–∏–∞—Ç–æ—Ä"}]}]},"–¢–µ–ª–µ—Ñ–æ–Ω—ã":{title:"üì± –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",fields:[{id:"phone_brand",label:"–ë—Ä–µ–Ω–¥",type:"text",required:!0,placeholder:"Apple, Samsung..."},{id:"phone_model",label:"–ú–æ–¥–µ–ª—å",type:"text",required:!0,placeholder:"iPhone 14 Pro"},{id:"phone_memory",label:"–ü–∞–º—è—Ç—å",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ",disabled:!0},{value:"64GB",label:"64 –ì–ë"},{value:"128GB",label:"128 –ì–ë"},{value:"256GB",label:"256 –ì–ë"},{value:"512GB",label:"512 –ì–ë"},{value:"1TB",label:"1 –¢–ë"}]}]}};function p(e,t){return!d.has(e)&&(!t||!u.has(t))}const m={async create(){const e=a.getState(),{formData:t,photos:i}=e;let s;p(t.category,t.subcategory)&&(s=t.negotiable?t.price?`${t.price} (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è");const n={category:t.category,subcategory:t.subcategory||void 0,ad_type:"–ü—Ä–æ–¥–∞–º",condition:t.condition||void 0,title:t.title.trim(),description:t.description.trim(),price:s,contact:t.contact.trim(),location:t.location?.address,dynamic_fields:t.dynamicFields,photos:i.map(e=>e.url),scheduled_time:t.scheduledTime||void 0},o=await l.post("/ads",n);return o.success&&o.data?{success:!0,adId:o.data.ad_id}:{success:!1,error:o.error||"Failed to create ad"}},collectFormDataForTelegram(){const e=a.getState(),{formData:t,photos:i}=e;let s=null;p(t.category,t.subcategory)&&(s=t.negotiable?t.price?`${t.price} (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è");const n={category:t.category,subcategory:t.subcategory,condition:t.condition,dynamicFields:t.dynamicFields,title:t.title.trim(),description:t.description.trim(),price:s,contact:t.contact.trim(),location:t.location?.address||null,locationLat:t.location?.lat||null,locationLon:t.location?.lng||null,negotiable:t.negotiable,photos:i.map(e=>e.url),photoCount:i.length,scheduledTime:t.scheduledTime||"now",timestamp:Date.now()};return JSON.stringify(n)}},g={required(e){const t=e.trim().length>0;return{valid:t,message:t?void 0:"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ"}},minLength(e,t){const i=e.trim().length>=t;return{valid:i,message:i?void 0:`–ú–∏–Ω–∏–º—É–º ${t} —Å–∏–º–≤–æ–ª–æ–≤`}},maxLength(e,t){const i=e.length<=t;return{valid:i,message:i?void 0:`–ú–∞–∫—Å–∏–º—É–º ${t} —Å–∏–º–≤–æ–ª–æ–≤`}},title(e){const t=e.trim();return t.length<n.minTitleLength?{valid:!1,message:`–ú–∏–Ω–∏–º—É–º ${n.minTitleLength} —Å–∏–º–≤–æ–ª–∞`}:t.length>n.maxTitleLength?{valid:!1,message:`–ú–∞–∫—Å–∏–º—É–º ${n.maxTitleLength} —Å–∏–º–≤–æ–ª–æ–≤`}:{valid:!0}},description(e){const t=e.trim();return t.length<n.minDescLength?{valid:!1,message:`–ú–∏–Ω–∏–º—É–º ${n.minDescLength} —Å–∏–º–≤–æ–ª–æ–≤`}:t.length>n.maxDescLength?{valid:!1,message:`–ú–∞–∫—Å–∏–º—É–º ${n.maxDescLength} —Å–∏–º–≤–æ–ª–æ–≤`}:{valid:!0}},contact(e){const t=e.trim();if(!t)return{valid:!1,message:"–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ –Ω–æ–º–µ—Ä"};if(t.startsWith("@")){return/^@[a-zA-Z][a-zA-Z0-9_]{4,31}$/.test(t)?{valid:!0,type:"username",message:"Telegram username ‚úì"}:{valid:!1,type:"username",message:"Username: 5-32 —Å–∏–º–≤–æ–ª–∞ –ø–æ—Å–ª–µ @"}}const i=t.replace(/\D/g,"");return i.length>=10&&i.length<=15?{valid:!0,type:"phone",message:"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚úì"}:i.length>0&&i.length<10?{valid:!1,type:"phone",message:"–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"}:{valid:!1,message:"–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ –Ω–æ–º–µ—Ä"}},select:e=>({valid:!!e,message:e?void 0:"–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ"}),scheduledTime(e,t){if(!e||!t)return{valid:!0};try{return new Date(`${e}T${t}`)<=new Date?{valid:!1,message:"–í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º"}:{valid:!0}}catch{return{valid:!1,message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è"}}}};function b(e,t){e&&(e.classList.remove("is-success","is-error"),t&&e.classList.add(`is-${t}`))}function v(e,t,i){if(!e)return;e.textContent=`${t}/${i}`,e.classList.remove("is-warning","is-danger");const a=t/i;a>=.95?e.classList.add("is-danger"):a>=.8&&e.classList.add("is-warning")}function y(e){return document.getElementById(e)}function f(e,...t){e?.classList.add(...t)}function w(e,...t){e?.classList.remove(...t)}function C(e,t){e&&(e.style.display=t)}function _(e){C(e,"")}function L(e){C(e,"none")}function S(e,t){e&&(e.innerHTML=t)}function D(e,t){e&&(e.textContent=t)}function $(e){return e?.value??""}function T(e,t){e&&(e.value=t)}const F=new class{constructor(){t(this,"elements",{})}init(){this.cacheElements(),this.setupEventListeners(),this.prefillContact()}cacheElements(){["category","subcategory","condition","title","description","price","contact","location","negotiable","scheduleToggle","scheduleDate","scheduleTime","titleCounter","descCounter","categoryGroup","subcategoryGroup","conditionGroup","titleGroup","descriptionGroup","contactGroup","subcategoryWrapper","conditionWrapper","dynamicFieldsContainer","priceCard","scheduleFieldsContainer","contactType","contactError","progressFill","progressText"].forEach(e=>{this.elements[e]=y(e)})}setupEventListeners(){const{elements:e}=this;e.category?.addEventListener("change",()=>this.handleCategoryChange()),e.subcategory?.addEventListener("change",()=>this.handleSubcategoryChange()),e.condition?.addEventListener("change",()=>this.handleConditionChange()),e.title?.addEventListener("input",()=>this.handleTitleInput()),e.description?.addEventListener("input",()=>this.handleDescriptionInput()),e.contact?.addEventListener("input",()=>this.handleContactInput()),e.price?.addEventListener("input",()=>this.updateProgress()),e.negotiable?.addEventListener("change",()=>{s.haptic("light"),this.updateProgress()}),e.scheduleToggle?.addEventListener("change",()=>this.handleScheduleToggle()),e.scheduleDate?.addEventListener("change",()=>this.updateScheduleHint()),e.scheduleTime?.addEventListener("change",()=>this.updateScheduleHint()),document.querySelectorAll(".input, .textarea, .select").forEach(e=>{e.addEventListener("focus",()=>s.haptic("light"))})}prefillContact(){const e=s.user;e?.username&&this.elements.contact&&(T(this.elements.contact,`@${e.username}`),this.handleContactInput())}handleCategoryChange(){const e=this.elements.category,t=$(e);if(!t)return;a.updateFormData({category:t,subcategory:null,condition:null}),a.clearDynamicFields(),w(e,"placeholder"),b(this.elements.categoryGroup,"success"),s.haptic("light");const i=this.elements.subcategory;i&&(i.value="",f(i,"placeholder")),b(this.elements.subcategoryGroup,null);const n=this.elements.condition;n&&(n.value="",f(n,"placeholder")),b(this.elements.conditionGroup,null),this.hideDynamicFields(),this.hideCondition(),r[t]?this.showSubcategories(t):this.hideSubcategories(),this.updatePriceCardVisibility(),this.updateProgress()}showSubcategories(e){const t=this.elements.subcategoryWrapper,i=this.elements.subcategory;if(!t||!i)return;const s=r[e];a.setCurrentSubcategories(s),i.innerHTML='<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>',s.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,i.appendChild(t)}),w(t,"hiding"),requestAnimationFrame(()=>f(t,"visible"))}hideSubcategories(){const e=this.elements.subcategoryWrapper;e?.classList.contains("visible")&&(f(e,"hiding"),setTimeout(()=>{w(e,"visible","hiding"),a.setCurrentSubcategories(null)},200))}handleSubcategoryChange(){const e=this.elements.subcategory,t=$(e);if(!t)return b(this.elements.subcategoryGroup,null),this.hideCondition(),this.hideDynamicFields(),void this.updatePriceCardVisibility();if(a.updateFormData({subcategory:t,condition:null}),w(e,"placeholder"),b(this.elements.subcategoryGroup,"success"),s.haptic("light"),c[t])this.showConditions(t);else{this.hideCondition();const e=this.elements.condition;e&&(e.value="")}h[t]?this.showDynamicFields(t):this.hideDynamicFields(),this.updatePriceCardVisibility(),this.updateProgress()}showConditions(e){const t=this.elements.conditionWrapper,i=this.elements.condition;if(!t||!i)return;const s=c[e];a.setCurrentConditions(s),i.innerHTML='<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</option>',s.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,i.appendChild(t)}),w(t,"hiding"),requestAnimationFrame(()=>f(t,"visible"))}hideCondition(){const e=this.elements.conditionWrapper;e?.classList.contains("visible")&&(f(e,"hiding"),setTimeout(()=>{w(e,"visible","hiding"),a.setCurrentConditions(null)},200))}handleConditionChange(){const e=this.elements.condition,t=$(e);t?(a.updateFormData({condition:t}),w(e,"placeholder"),b(this.elements.conditionGroup,"success"),s.haptic("light"),this.updateConditionalFields()):b(this.elements.conditionGroup,null),this.updateProgress()}showDynamicFields(e){this.hideDynamicFields();const t=h[e];if(!t)return;a.setCurrentDynamicFields(t);const i=this.elements.dynamicFieldsContainer;if(!i)return;let n=`\n      <article class="card dynamic-section" id="dynamicFieldsCard">\n        <header class="card-header">\n          <h2 class="card-title">${t.title}</h2>\n        </header>\n        <div class="card-body">\n    `;t.fields.forEach(e=>{const t=`dynamic_${e.id}`,i=!!e.condition;if(n+=`\n        <div class="form-group ${i?"conditional-field":""}"\n             id="${t}Group"\n             ${i?`data-condition="${e.condition}"`:""}\n             style="${i?"display: none;":""}">\n          <label class="form-label" for="${t}">\n            ${e.label}\n            <span class="badge ${e.required?"badge--required":"badge--optional"}">\n              ${e.required?"–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ":"–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ"}\n            </span>\n          </label>\n      `,"select"===e.type&&e.options)n+=`<select class="select placeholder" id="${t}" name="${t}" ${e.required?"required":""}>`,e.options.forEach(e=>{n+=`<option value="${e.value}" ${e.disabled?"disabled selected":""}>${e.label}</option>`}),n+="</select>";else if("textarea"===e.type)n+=`<textarea class="textarea" id="${t}" name="${t}" placeholder="${e.placeholder||""}" ${e.required?"required":""}></textarea>`;else{const i=[`type="${e.type}"`,`id="${t}"`,`name="${t}"`,`placeholder="${e.placeholder||""}"`,void 0!==e.min?`min="${e.min}"`:"",void 0!==e.max?`max="${e.max}"`:"",e.required?"required":""].filter(Boolean).join(" ");n+=`<input class="input" ${i}>`}e.required&&(n+='<p class="error-message">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –ø–æ–ª–µ</p>'),n+="</div>"}),n+="</div></article>",i.innerHTML=n,t.fields.forEach(e=>{const t=y(`dynamic_${e.id}`);t&&(t.addEventListener("input",t=>this.handleDynamicFieldInput(t,e)),t.addEventListener("change",t=>this.handleDynamicFieldInput(t,e)),t.addEventListener("focus",()=>s.haptic("light")))});const l=y("dynamicFieldsCard");requestAnimationFrame(()=>l?.classList.add("visible")),this.updateConditionalFields()}hideDynamicFields(){const e=y("dynamicFieldsCard");e&&(e.classList.add("hiding"),setTimeout(()=>{e.remove(),a.setCurrentDynamicFields(null),a.clearDynamicFields()},300))}handleDynamicFieldInput(e,t){const i=e.target;a.setDynamicField(t.id,i.value);const n=y(`dynamic_${t.id}Group`);t.required&&b(n,i.value.trim()?"success":null),"SELECT"===i.tagName&&i.value&&w(i,"placeholder"),this.updateProgress(),s.haptic("light")}updateConditionalFields(){const e=a.getState().formData.condition;document.querySelectorAll(".conditional-field").forEach(t=>{const i=t,a=i.dataset.condition;if(!a)return;const s=e===a;if(i.style.display=s?"block":"none",!s){const e=i.querySelector(".input, .select, .textarea");e&&(e.value="")}})}handleTitleInput(){const e=$(this.elements.title);a.updateFormData({title:e}),v(this.elements.titleCounter,e.length,n.maxTitleLength);const t=g.title(e);b(this.elements.titleGroup,t.valid?"success":null),this.updateProgress()}handleDescriptionInput(){const e=$(this.elements.description);a.updateFormData({description:e}),v(this.elements.descCounter,e.length,n.maxDescLength);const t=g.description(e);b(this.elements.descriptionGroup,t.valid?"success":null),this.updateProgress()}handleContactInput(){const e=$(this.elements.contact);a.updateFormData({contact:e});const t=g.contact(e),i=this.elements.contactType,s=this.elements.contactError;i&&i.classList.remove("is-visible"),b(this.elements.contactGroup,null),t.valid?(i&&(i.textContent=t.message||"",i.classList.add("is-visible")),b(this.elements.contactGroup,"success")):e.trim()&&s&&(s.textContent=t.message||""),this.updateProgress()}handleScheduleToggle(){const e=this.elements.scheduleToggle,t=this.elements.scheduleFieldsContainer;t&&(t.style.display=e?.checked?"block":"none"),e?.checked?this.updateScheduleHint():a.updateFormData({scheduledTime:null}),s.haptic("light")}updateScheduleHint(){const e=this.elements.scheduleToggle,t=this.elements.scheduleDate,i=this.elements.scheduleTime,s=y("scheduleHint");if(!e?.checked||!s)return;const n=$(t),l=$(i);if(n&&l)try{const e=new Date(`${n}T${l}`),t=new Date;if(e<=t)s.textContent="‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –±—É–¥—É—â–µ–µ –≤—Ä–µ–º—è",s.style.color="var(--color-warning)",a.updateFormData({scheduledTime:null});else{a.updateFormData({scheduledTime:`${n}T${l}:00`});const i=Math.floor((e.getTime()-t.getTime())/36e5),o=Math.floor(i/24);let r;if(o>0){r=`–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ${o} ${1===o?"–¥–µ–Ω—å":o<5?"–¥–Ω—è":"–¥–Ω–µ–π"}`}else if(i>0){r=`–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ${i} ${1===i?"—á–∞—Å":i<5?"—á–∞—Å–∞":"—á–∞—Å–æ–≤"}`}else r="–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –º–µ–Ω–µ–µ —á–∞—Å–∞";s.textContent=r,s.style.color="var(--tg-hint)"}}catch{s.textContent="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è",s.style.color="var(--tg-hint)"}}updatePriceCardVisibility(){const e=a.getState(),t=this.elements.priceCard;if(!t)return;const i=p(e.formData.category,e.formData.subcategory);if(t.style.display=i?"block":"none",!i){a.updateFormData({price:"",negotiable:!1});const e=this.elements.price,t=this.elements.negotiable;e&&(e.value=""),t&&(t.checked=!1)}}updateProgress(){const e=a.getState(),{formData:t}=e;let i=0,s=0;s++,t.category&&i++,e.currentSubcategories&&(s++,t.subcategory&&i++),e.currentConditions&&(s++,t.condition&&i++),e.currentDynamicFields&&e.currentDynamicFields.fields.forEach(e=>{e.required&&(e.condition&&t.condition!==e.condition||(s++,t.dynamicFields[e.id]?.trim()&&i++))}),s++,g.title(t.title).valid&&i++,s++,g.description(t.description).valid&&i++,s++,g.contact(t.contact).valid&&i++;const n=s>0?Math.round(i/s*100):0,l=i===s&&s>0,o=this.elements.progressFill,r=this.elements.progressText;return o&&(o.style.width=`${n}%`,o.classList.toggle("complete",l)),r&&(r.textContent=`${n}%`),this.updateMainButton(l,n),n}updateMainButton(e,t){const i=a.getState();"form"===i.currentView&&(i.uploadingCount>0?s.updateMainButton({text:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...",enabled:!1}):e?s.updateMainButton({text:"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí",enabled:!0,color:s.themeParams.button_color||"#007aff"}):s.updateMainButton({text:`–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É (${t}%)`,enabled:!1,color:"#8e8e93"}))}validate(){const e=a.getState(),{formData:t}=e,i=[];[this.elements.categoryGroup,this.elements.subcategoryGroup,this.elements.conditionGroup,this.elements.titleGroup,this.elements.descriptionGroup,this.elements.contactGroup].forEach(e=>b(e,null)),t.category||(b(this.elements.categoryGroup,"error"),i.push("‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è")),e.currentSubcategories&&!t.subcategory&&(b(this.elements.subcategoryGroup,"error"),i.push("‚Ä¢ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è")),e.currentConditions&&!t.condition&&(b(this.elements.conditionGroup,"error"),i.push("‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ")),e.currentDynamicFields&&e.currentDynamicFields.fields.forEach(e=>{e.required&&(e.condition&&t.condition!==e.condition||t.dynamicFields[e.id]?.trim()||(b(y(`dynamic_${e.id}Group`),"error"),i.push(`‚Ä¢ ${e.label}`)))}),g.title(t.title).valid||(b(this.elements.titleGroup,"error"),i.push("‚Ä¢ –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)")),g.description(t.description).valid||(b(this.elements.descriptionGroup,"error"),i.push("‚Ä¢ –û–ø–∏—Å–∞–Ω–∏–µ (–º–∏–Ω. 10 —Å–∏–º–≤–æ–ª–æ–≤)"));const s=g.contact(t.contact);if(!s.valid){const e=this.elements.contactError;e&&(e.textContent=s.message||""),b(this.elements.contactGroup,"error"),i.push("‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏")}const n=this.elements.scheduleToggle;if(n?.checked){const e=this.elements.scheduleDate,t=this.elements.scheduleTime;g.scheduledTime($(e),$(t)).valid||i.push("‚Ä¢ –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º")}return{valid:0===i.length,errors:i}}syncToStore(){const e=this.elements.price,t=this.elements.negotiable;a.updateFormData({price:$(e),negotiable:t?.checked||!1})}},x={async upload(e){const t=await this.fileToBase64(e),i=await l.post("/photos/upload",{image:t,filename:e.name});return i.success&&i.data?i.data:{success:!1,error:i.error||"Upload failed"}},async uploadWithRetry(e,t=n.uploadRetryCount){for(let i=0;i<=t;i++){const a=await this.upload(e);if(a.success)return a;i<t&&await this.delay(n.uploadRetryDelay*(i+1))}return{success:!1,error:"Upload failed after retries"}},fileToBase64:e=>new Promise((t,i)=>{const a=new FileReader;a.onload=()=>{const e=a.result,i=e.includes(",")?e.split(",")[1]:e;t(i)},a.onerror=i,a.readAsDataURL(e)}),delay:e=>new Promise(t=>setTimeout(t,e)),validateFile(e){if(!e.type.startsWith("image/"))return{valid:!1,error:"Not an image file"};if(e.size>n.maxFileSize)return{valid:!1,error:`File too large (max ${n.maxFileSize/1024/1024}MB)`};const t=a.getState();return t.photos.length+t.uploadingCount>=n.maxPhotos?{valid:!1,error:`Maximum ${n.maxPhotos} photos allowed`}:{valid:!0}}};const E=new class{constructor(){t(this,"uploadArea",null),t(this,"input",null),t(this,"grid",null),t(this,"status",null),t(this,"localUrls",new Set)}init(){this.uploadArea=y("photoUploadArea"),this.input=y("photoInput"),this.grid=y("photoPreviewGrid"),this.status=y("photoStatus"),this.setupEventListeners()}setupEventListeners(){this.uploadArea?.addEventListener("click",()=>{const e=a.getState();e.photos.length+e.uploadingCount<n.maxPhotos&&(this.input?.click(),s.haptic("light"))}),this.input?.addEventListener("change",e=>{const t=e.target.files;t?.length&&(this.handleFiles(t),this.input&&(this.input.value=""))}),this.uploadArea?.addEventListener("dragover",e=>{e.preventDefault(),f(this.uploadArea,"dragover")}),this.uploadArea?.addEventListener("dragleave",()=>{w(this.uploadArea,"dragover")}),this.uploadArea?.addEventListener("drop",e=>{e.preventDefault(),w(this.uploadArea,"dragover");const t=e.dataTransfer?.files;t?.length&&this.handleFiles(t)})}async handleFiles(e){for(const t of Array.from(e)){const e=a.getState();if(e.photos.length+e.uploadingCount>=n.maxPhotos){this.setStatus(`–ú–∞–∫—Å–∏–º—É–º ${n.maxPhotos} —Ñ–æ—Ç–æ`,"error"),s.haptic("error");break}const i=x.validateFile(t);i.valid?await this.uploadFile(t):(this.setStatus(i.error||"–û—à–∏–±–∫–∞","error"),s.haptic("error"))}}async uploadFile(e){const t=`temp_${Date.now()}_${Math.random().toString(36).slice(2)}`,i=URL.createObjectURL(e);this.localUrls.add(i),this.addPreview(t,i,!0),a.incrementUploading(),this.updateUploadArea(),F.updateProgress();try{this.setStatus("–ó–∞–≥—Ä—É–∑–∫–∞...","");const i=await x.uploadWithRetry(e);i.success&&i.url?(a.addPhoto({id:i.url,url:i.url,thumb:i.url}),this.updatePreview(t,i.url),this.setStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${a.getState().photos.length} –∏–∑ ${n.maxPhotos}`,"success"),s.haptic("success")):(this.removePreview(t),this.setStatus(i.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏","error"),s.haptic("error"))}catch(l){this.removePreview(t),this.setStatus(`–û—à–∏–±–∫–∞: ${l.message}`,"error"),s.haptic("error")}finally{a.decrementUploading(),URL.revokeObjectURL(i),this.localUrls.delete(i),this.updateUploadArea(),F.updateProgress()}}addPreview(e,t,i){if(!this.grid)return;const a=document.createElement("div");a.className="photo-preview-item"+(i?" uploading":""),a.dataset.id=e,a.innerHTML=`\n      <img src="${t}" alt="–§–æ—Ç–æ" loading="lazy">\n      ${i?'<div class="upload-spinner"></div>':`<button type="button" class="photo-remove-btn" data-id="${e}" aria-label="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>`}\n    `,this.grid.appendChild(a),i||this.attachRemoveHandler(a,e)}updatePreview(e,t){const i=this.grid?.querySelector(`[data-id="${e}"]`);i&&(i.classList.remove("uploading"),i.dataset.id=t,i.innerHTML=`\n      <img src="${t}" alt="–§–æ—Ç–æ" loading="lazy">\n      <button type="button" class="photo-remove-btn" data-id="${t}" aria-label="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>\n    `,this.attachRemoveHandler(i,t))}removePreview(e){this.grid?.querySelector(`[data-id="${e}"]`)?.remove()}attachRemoveHandler(e,t){const i=e.querySelector(".photo-remove-btn");i?.addEventListener("click",e=>{e.stopPropagation(),this.removePhoto(t)})}removePhoto(e){a.removePhoto(e),this.removePreview(e),this.updateUploadArea(),F.updateProgress();const t=a.getState().photos.length;this.setStatus(t>0?`${t} –∏–∑ ${n.maxPhotos} —Ñ–æ—Ç–æ`:"",""),s.haptic("light")}updateUploadArea(){if(!this.uploadArea)return;const e=a.getState(),t=e.photos.length+e.uploadingCount,i=this.uploadArea.querySelector(".upload-text");t>=n.maxPhotos?(i&&(i.textContent="–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ñ–æ—Ç–æ"),f(this.uploadArea,"has-photos")):t>0?(i&&(i.textContent="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ñ–æ—Ç–æ"),f(this.uploadArea,"has-photos")):(i&&(i.textContent="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ"),w(this.uploadArea,"has-photos")),this.uploadArea.classList.toggle("uploading",e.uploadingCount>0)}setStatus(e,t){this.status&&(D(this.status,e),this.status.className="photo-status"+(t?` ${t}`:""))}cleanup(){this.localUrls.forEach(e=>{try{URL.revokeObjectURL(e)}catch{}}),this.localUrls.clear()}};const P=new class{render(){const e=a.getState(),{formData:t,photos:i}=e;let s=t.category?`#${t.category.replace(/\s+/g,"_").replace(/[()]/g,"")}`:"";t.subcategory&&(s+=` #${t.subcategory}`),t.condition&&(s+=` #${t.condition}`),D(y("previewHashtags"),s),D(y("previewTitle"),t.title.trim()),D(y("previewDescription"),t.description.trim());let n="";if(p(t.category,t.subcategory)){let e;e=t.negotiable?t.price?`${t.price} ‚ÇΩ (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è",n+=this.infoItem("üí∞","–¶–µ–Ω–∞:",e)}if(e.currentDynamicFields&&(n+=this.renderDynamicFieldsInfo(e.currentDynamicFields,t)),t.location){let e=t.location.address;e+=` <a href="https://www.google.com/maps?q=${t.location.lat},${t.location.lng}" target="_blank" style="color: #64B5EF;">üó∫Ô∏è</a>`,n+=this.infoItem("üìç","–õ–æ–∫–∞—Ü–∏—è:",e)}if(n+=this.infoItem("üë§","–ö–æ–Ω—Ç–∞–∫—Ç:",t.contact.trim()),t.scheduledTime)try{const e=new Date(t.scheduledTime).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});n+=this.infoItem("‚è∞","–ü—É–±–ª–∏–∫–∞—Ü–∏—è:",e)}catch{}S(y("previewInfo"),n),this.renderPhotos(i)}infoItem(e,t,i){return`\n      <div class="message-info-item">\n        <span class="message-info-icon">${e}</span>\n        <span><span class="message-info-label">${t}</span> ${i}</span>\n      </div>\n    `}renderDynamicFieldsInfo(e,t){let i="";return e.fields.forEach(e=>{if(e.condition&&t.condition!==e.condition)return;const a=t.dynamicFields[e.id];if(!a?.trim())return;if(e.id.includes("salary_from")||e.id.includes("desired_salary_from")||e.id.includes("payment_from")){const s=e.id.replace("_from","_to"),n=t.dynamicFields[s],l=n?`${a} - ${n} ‚ÇΩ`:`–æ—Ç ${a} ‚ÇΩ`,o=e.id.includes("desired_salary")?"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞":e.id.includes("payment")?"–û–ø–ª–∞—Ç–∞":"–ó–∞—Ä–ø–ª–∞—Ç–∞";return void(i+=this.infoItem("üí∞",`${o}:`,l))}if(e.id.includes("_to")&&(e.id.includes("salary")||e.id.includes("payment")))return;const s=Object.entries({brand:"üè∑Ô∏è",model:"üè∑Ô∏è",year:"üìÖ",mileage:"üõ£Ô∏è",sphere:"üíº",position:"üíº",schedule:"‚è∞",experience:"‚≠ê",type:"üìù",employment:"üìù",duration:"‚è±Ô∏è"}).find(([t])=>e.id.toLowerCase().includes(t))?.[1]||"üìã";i+=this.infoItem(s,`${e.label}:`,a)}),i}renderPhotos(e){const t=y("previewPhotos");if(!t)return;if(0===e.length)return void L(t);const i=e.length;if(1===i)t.className="message-photos single-photo",S(t,`<div class="message-photo"><img src="${e[0].thumb}" alt="–§–æ—Ç–æ" loading="lazy"></div>`);else{t.className=`message-photos multiple-photos count-${i}`;S(t,e.map(e=>`<div class="message-photo"><img src="${e.thumb}" alt="–§–æ—Ç–æ" loading="lazy"></div>`).join(""))}var a,s;_(t),s={display:"grid"},(a=t)&&Object.assign(a.style,s)}};const A=new class{constructor(){t(this,"map",null),t(this,"selectedLocation",null)}init(){this.loadYandexMaps(),this.setupEventListeners()}loadYandexMaps(){const e=document.getElementById("yandex-maps");e&&!e.src&&(e.src=`https://api-maps.yandex.ru/2.1/?apikey=${n.yandexMapsKey}&lang=ru_RU`)}setupEventListeners(){y("location")?.addEventListener("click",()=>this.open()),y("location")?.addEventListener("focus",e=>{e.target.blur(),this.open()}),y("mapCloseBtn")?.addEventListener("click",()=>this.close()),y("mapCancelBtn")?.addEventListener("click",()=>this.close()),y("mapConfirmBtn")?.addEventListener("click",()=>this.confirm()),y("mapMyLocationBtn")?.addEventListener("click",()=>{s.haptic("light"),this.getUserLocation()})}open(){const e=y("mapModal");e&&(f(e,"active"),document.body.style.overflow="hidden",setTimeout(()=>this.initMap(),100),s.haptic("light"))}close(){const e=y("mapModal");e&&(w(e,"active"),document.body.style.overflow="",document.getElementById("centerMarker")?.remove(),this.map&&(this.map.destroy(),this.map=null),s.haptic("light"))}initMap(){this.map||"undefined"==typeof ymaps?"undefined"==typeof ymaps&&setTimeout(()=>this.initMap(),500):ymaps.ready(()=>{this.map=new ymaps.Map("locationMap",{center:n.defaultMapCenter,zoom:13,controls:[]});const e=document.createElement("div");let t;e.id="centerMarker",e.style.cssText="\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -100%);\n        z-index: 1000;\n        pointer-events: none;\n        font-size: 40px;\n        filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));\n      ",e.innerHTML="üìç",this.map.container.getParentElement().appendChild(e),this.map.events.add("boundschange",()=>{clearTimeout(t),t=setTimeout(()=>{const e=this.map.getCenter();this.updateAddress(e[0],e[1])},500)}),this.getUserLocation()})}getUserLocation(){if(!navigator.geolocation)return void this.updateAddress(n.defaultMapCenter[0],n.defaultMapCenter[1]);const e=y("mapAddress");e&&S(e,'<span class="map-address-loading">‚è≥ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</span>'),navigator.geolocation.getCurrentPosition(e=>{this.map&&(this.map.setCenter([e.coords.latitude,e.coords.longitude],15,{duration:300}),this.updateAddress(e.coords.latitude,e.coords.longitude)),s.haptic("success")},()=>{this.updateAddress(n.defaultMapCenter[0],n.defaultMapCenter[1])},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}async updateAddress(e,t){const i=y("mapAddress"),a=y("mapConfirmBtn");i&&S(i,'<span class="map-address-loading">üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞...</span>'),a&&(a.disabled=!0);try{const i=(await new Promise((i,a)=>{ymaps.geocode([e,t],{results:1}).then(i).catch(a)})).geoObjects.get(0);if(!i)throw new Error("Address not found");let a=i.getAddressLine().replace(/^–†–µ—Å–ø—É–±–ª–∏–∫–∞\s+[^,]+,\s*/i,"").replace(/^[–ê-–Ø–∞-—è\s]+–æ–±–ª–∞—Å—Ç—å,\s*/i,"").replace(/^[–ê-–Ø–∞-—è\s]+–∫—Ä–∞–π,\s*/i,"");this.selectedLocation={address:a||`${e.toFixed(4)}, ${t.toFixed(4)}`,lat:e,lng:t}}catch{this.selectedLocation={address:`${e.toFixed(4)}, ${t.toFixed(4)}`,lat:e,lng:t}}i&&S(i,`üìç ${this.selectedLocation.address}`),a&&(a.disabled=!1)}confirm(){if(!this.selectedLocation)return;a.setLocation(this.selectedLocation);const e=y("location"),t=y("locationHint");e&&(T(e,this.selectedLocation.address),f(e,"location-selected")),t&&(t.textContent="‚úì –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ",f(t,"location-selected")),this.close(),s.haptic("success")}};const q=new class{constructor(){t(this,"header",null),t(this,"slotsIndicator",null),t(this,"slotsCount",null),t(this,"cooldownWarning",null),t(this,"cooldownTime",null)}init(){this.header=y("header"),this.slotsIndicator=y("slotsIndicator"),this.slotsCount=y("slotsCount"),this.cooldownWarning=y("cooldownWarning"),this.cooldownTime=y("cooldownTime"),this.setupScrollListener(),this.update(),a.subscribe(()=>this.update())}setupScrollListener(){const e=function(e,t){let i=!1;return(...a)=>{i||(e(...a),i=!0,setTimeout(()=>i=!1,t))}}(()=>{this.header&&this.header.classList.toggle("scrolled",window.scrollY>20)},100);window.addEventListener("scroll",e,{passive:!0})}update(){const e=a.getState().userLimits;if(this.slotsIndicator&&this.slotsCount&&e){const t=e.availableSlots;D(this.slotsCount,`${t}/${e.maxSlots}`),w(this.slotsIndicator,"warning","full"),0===t?f(this.slotsIndicator,"full"):t<=2&&f(this.slotsIndicator,"warning")}if(this.cooldownWarning&&this.cooldownTime&&e)if(e.cooldownSeconds&&e.cooldownSeconds>0){const t=Math.floor(e.cooldownSeconds/3600),i=Math.floor(e.cooldownSeconds%3600/60);D(this.cooldownTime,t>0?`${t} —á ${i} –º–∏–Ω`:`${i} –º–∏–Ω`),f(this.cooldownWarning,"visible")}else w(this.cooldownWarning,"visible")}setTitle(e,t){D(y("headerTitle"),e),D(y("headerSubtitle"),t)}};const M=new class{constructor(){t(this,"formView",null),t(this,"previewView",null)}async init(){s.init(),this.formView=y("formView"),this.previewView=y("previewView"),q.init(),F.init(),E.init(),A.init(),this.setupNavigation(),this.initScheduleDate(),await this.authenticate(),this.setupMainButton(),this.setupClosingConfirmation()}async authenticate(){try{await o.authenticate()?(await o.getUserLimits(),q.update()):(a.setUserLimits({activeSlots:0,maxSlots:5,availableSlots:5,cooldownSeconds:null,canPublish:!0,isAdmin:!1}),q.update())}catch(e){}}setupMainButton(){s.setupMainButton("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É",()=>{this.handleMainButtonClick()}),s.updateMainButton({enabled:!1,visible:!0,color:"#8e8e93"})}handleMainButtonClick(){"form"===a.getState().currentView?this.showPreview():this.submitAd()}setupNavigation(){y("backToFormBtn")?.addEventListener("click",()=>{this.showForm()}),y("submitBtn")?.addEventListener("click",()=>{this.submitAd()})}initScheduleDate(){const e=y("scheduleDate");if(!e)return;const t=new Date,i=new Date(t);i.setDate(i.getDate()+1),e.min=t.toISOString().split("T")[0],e.value=i.toISOString().split("T")[0]}showForm(){a.setCurrentView("form"),f(this.previewView,"slide-out-right"),setTimeout(()=>{L(this.previewView),w(this.previewView,"slide-out-right"),_(this.formView),f(this.formView,"active","slide-in-left"),setTimeout(()=>{w(this.formView,"slide-in-left")},300)},300),q.setTitle("–ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ","–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É"),s.setupMainButton("–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí",()=>this.showPreview()),F.updateProgress(),s.haptic("light")}showPreview(){F.syncToStore();const{valid:e,errors:t}=F.validate();if(!e)return s.haptic("error"),void s.showPopup("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ","–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n\n"+t.join("\n"));a.setCurrentView("preview"),P.render(),f(this.formView,"slide-out-left"),setTimeout(()=>{L(this.formView),w(this.formView,"slide-out-left","active"),_(this.previewView),f(this.previewView,"active","slide-in-right"),setTimeout(()=>{w(this.previewView,"slide-in-right")},300)},300),q.setTitle("–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä","–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"),s.setupMainButton("‚úì –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é",()=>this.submitAd()),s.updateMainButton({enabled:!0,color:s.themeParams.button_color||"#007aff"}),s.haptic("success")}async submitAd(){s.haptic("medium"),s.updateMainButton({progress:!0,enabled:!1});try{if(a.getState().isAuthenticated){if((await m.create()).success)return s.haptic("success"),void s.showAlert("‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!",()=>{s.tg?.close()})}const e=m.collectFormDataForTelegram();if(e.length>n.maxDataSize)throw new Error("–î–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ. –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ.");s.sendData(e)?s.haptic("success"):alert(`–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏\n\n–î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã: ${e.length} bytes`)}catch(e){s.haptic("error"),s.showPopup("–û—à–∏–±–∫–∞",e.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ")}finally{s.updateMainButton({progress:!1,enabled:!0})}}setupClosingConfirmation(){a.subscribe(e=>{e.formData.category||e.formData.title.trim()||e.formData.description.trim()||e.formData.contact.trim()||e.photos.length>0?s.enableClosingConfirmation():s.disableClosingConfirmation()})}destroy(){E.cleanup()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>M.init()):M.init(),window.addEventListener("beforeunload",()=>{M.destroy()});
