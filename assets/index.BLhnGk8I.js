var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s={token:null,isAuthenticated:!1,userLimits:null,currentTab:"create",formData:{category:"",subcategory:null,condition:null,title:"",description:"",price:"",negotiable:!1,contact:"",location:null,dynamicFields:{},scheduledTime:null},photos:[],uploadingCount:0,currentView:"form",isLoading:!1,error:null,currentSubcategories:null,currentConditions:null,currentDynamicFields:null,userAds:[],userAdsLoading:!1,userAdsError:null};const i=new class{constructor(){t(this,"state",{...s}),t(this,"listeners",new Set)}getState(){return this.state}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}setState(e){this.state={...this.state,...e},this.notify()}setToken(e){this.setState({token:e,isAuthenticated:!!e})}setUserLimits(e){this.setState({userLimits:e})}setCurrentTab(e){this.setState({currentTab:e})}updateFormData(e){this.setState({formData:{...this.state.formData,...e}})}setDynamicField(e,t){this.setState({formData:{...this.state.formData,dynamicFields:{...this.state.formData.dynamicFields,[e]:t}}})}clearDynamicFields(){this.setState({formData:{...this.state.formData,dynamicFields:{}}})}setLocation(e){this.setState({formData:{...this.state.formData,location:e}})}addPhoto(e){this.setState({photos:[...this.state.photos,e]})}updatePhoto(e,t){this.setState({photos:this.state.photos.map(s=>s.id===e?{...s,...t}:s)})}removePhoto(e){this.setState({photos:this.state.photos.filter(t=>t.id!==e)})}setUploadingCount(e){this.setState({uploadingCount:e})}incrementUploading(){this.setState({uploadingCount:this.state.uploadingCount+1})}decrementUploading(){this.setState({uploadingCount:Math.max(0,this.state.uploadingCount-1)})}setCurrentView(e){this.setState({currentView:e})}setLoading(e){this.setState({isLoading:e})}setError(e){this.setState({error:e})}setCurrentSubcategories(e){this.setState({currentSubcategories:e})}setCurrentConditions(e){this.setState({currentConditions:e})}setCurrentDynamicFields(e){this.setState({currentDynamicFields:e})}setUserAds(e){this.setState({userAds:e})}setUserAdsLoading(e){this.setState({userAdsLoading:e})}setUserAdsError(e){this.setState({userAdsError:e})}removeUserAd(e){this.setState({userAds:this.state.userAds.filter(t=>t.id!==e)})}updateUserAd(e,t){this.setState({userAds:this.state.userAds.map(s=>s.id===e?{...s,...t}:s)})}reset(){this.state={...s},this.notify()}resetForm(){this.setState({formData:{...s.formData},photos:[],uploadingCount:0,currentSubcategories:null,currentConditions:null,currentDynamicFields:null})}};const a=new class{constructor(){t(this,"_tg",null),t(this,"_initialized",!1),t(this,"_mainButtonCallback",null)}get tg(){return this._tg}get isAvailable(){return null!==this._tg}get user(){return this._tg?.initDataUnsafe?.user}get initData(){return this._tg?.initData||""}get themeParams(){return this._tg?.themeParams||{}}get colorScheme(){return this._tg?.colorScheme||"light"}get mainButton(){return this._tg?.MainButton}init(){if(this._initialized)return this.isAvailable;if(this._tg=window.Telegram?.WebApp||null,this._initialized=!0,!this._tg)return!1;try{return this._tg.ready(),this._tg.expand(),this._tg.enableClosingConfirmation(),!0}catch(e){return!1}}haptic(e="light"){if(this._tg?.HapticFeedback)try{["success","error","warning"].includes(e)?this._tg.HapticFeedback.notificationOccurred(e):this._tg.HapticFeedback.impactOccurred(e)}catch(t){}}showPopup(e,t,s){this._tg?.showPopup?this._tg.showPopup({title:e,message:t,buttons:s||[{type:"ok"}]}):alert(`${e}\n\n${t}`)}showAlert(e,t){this._tg?.showAlert?this._tg.showAlert(e,t):(alert(e),t?.())}showConfirm(e,t){this._tg?.showConfirm?this._tg.showConfirm(e,t):t(confirm(e))}sendData(e){return!!this._tg?.sendData&&(this._tg.sendData(e),!0)}setupMainButton(e,t){const s=this.mainButton;if(s)try{this._mainButtonCallback&&s.offClick(this._mainButtonCallback),this._mainButtonCallback=t,s.setText(e),s.onClick(t),s.show()}catch(i){}}updateMainButton(e){const t=this.mainButton;if(t)try{void 0!==e.text&&t.setText(e.text),!0===e.enabled&&t.enable(),!1===e.enabled&&t.disable(),!0===e.visible&&t.show(),!1===e.visible&&t.hide(),!0===e.progress&&t.showProgress(!0),!1===e.progress&&t.hideProgress(),e.color&&(t.color=e.color)}catch(s){}}enableClosingConfirmation(){try{this._tg?.enableClosingConfirmation()}catch(e){}}disableClosingConfirmation(){try{this._tg?.disableClosingConfirmation()}catch(e){}}},n={apiUrl:"https://your-api-domain.com/api",yandexMapsKey:"0ea443fd-4bed-4404-a064-f2202a8de835",maxPhotos:5,maxFileSize:5242880,maxDataSize:4e4,minTitleLength:3,maxTitleLength:100,minDescLength:10,maxDescLength:1e3,defaultMapCenter:[43.024615,44.681767],uploadRetryCount:2,uploadRetryDelay:1e3,apiTimeout:3e4,debug:!1};const o=new class{constructor(){t(this,"baseUrl"),t(this,"timeout"),this.baseUrl=n.apiUrl,this.timeout=n.apiTimeout}getHeaders(){const e={"Content-Type":"application/json"},t=i.getState().token;return t&&(e.Authorization=`Bearer ${t}`),e}async request(e,t,s,i){const a=new AbortController,n=setTimeout(()=>a.abort(),this.timeout);try{const n=`${this.baseUrl}${t}`,o={method:e,headers:{...this.getHeaders(),...i},signal:a.signal};s&&"GET"!==e&&(o.body=JSON.stringify(s));const l=await fetch(n,o),r=await l.json();return l.ok?{success:!0,data:r}:{success:!1,error:r.error||`HTTP ${l.status}`,code:r.code}}catch(o){return"AbortError"===o.name?{success:!1,error:"Request timeout"}:{success:!1,error:o.message||"Network error"}}finally{clearTimeout(n)}}get(e){return this.request("GET",e)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}delete(e){return this.request("DELETE",e)}},l={async authenticate(){const e=a.initData;if(!e)return!1;const t=await o.post("/auth/token",{init_data:e});return!(!t.success||!t.data)&&(i.setToken(t.data.access_token),!0)},async getUserLimits(){const e=await o.get("/user/limits");return!(!e.success||!e.data)&&(i.setUserLimits({activeSlots:e.data.active_slots,maxSlots:e.data.max_slots,availableSlots:e.data.available_slots,cooldownSeconds:e.data.cooldown_remaining_seconds||null,canPublish:e.data.can_publish,isAdmin:e.data.is_admin}),!0)},logout(){i.setToken(null),i.setUserLimits(null)}},r={"–†–∞–±–æ—Ç–∞":[{value:"–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",label:"üëî –ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},{value:"–ò—â—É_—Ä–∞–±–æ—Ç—É",label:"üíº –ò—â—É —Ä–∞–±–æ—Ç—É"},{value:"–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞",label:"‚è∞ –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞"},{value:"–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞",label:"üéì –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞"}],"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç":[{value:"–õ–µ–≥–∫–æ–≤—ã–µ",label:"üöó –õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏"},{value:"–ì—Ä—É–∑–æ–≤–∏–∫–∏",label:"üöö –ì—Ä—É–∑–æ–≤–∏–∫–∏"},{value:"–ú–æ—Ç–æ—Ü–∏–∫–ª—ã",label:"üèçÔ∏è –ú–æ—Ç–æ—Ü–∏–∫–ª—ã"},{value:"–°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞",label:"üöú –°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞"},{value:"–ó–∞–ø—á–∞—Å—Ç–∏",label:"üîß –ó–∞–ø—á–∞—Å—Ç–∏"}],"–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞":[{value:"–¢–µ–ª–µ—Ñ–æ–Ω—ã",label:"üì± –¢–µ–ª–µ—Ñ–æ–Ω—ã"},{value:"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã",label:"üíª –ö–æ–º–ø—å—é—Ç–µ—Ä—ã"},{value:"–ù–æ—É—Ç–±—É–∫–∏",label:"üíª –ù–æ—É—Ç–±—É–∫–∏"},{value:"–ü–ª–∞–Ω—à–µ—Ç—ã",label:"üì≤ –ü–ª–∞–Ω—à–µ—Ç—ã"},{value:"–¢–í_–ê—É–¥–∏–æ",label:"üì∫ –¢–í –∏ –ê—É–¥–∏–æ"},{value:"–§–æ—Ç–æ_–í–∏–¥–µ–æ",label:"üì∑ –§–æ—Ç–æ –∏ –í–∏–¥–µ–æ"},{value:"–ò–≥—Ä–æ–≤—ã–µ",label:"üéÆ –ò–≥—Ä–æ–≤—ã–µ –ø—Ä–∏—Å—Ç–∞–≤–∫–∏"}],"–û–¥–µ–∂–¥–∞":[{value:"–ñ–µ–Ω—Å–∫–∞—è",label:"üëó –ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"},{value:"–ú—É–∂—Å–∫–∞—è",label:"üëî –ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"},{value:"–û–±—É–≤—å",label:"üëü –û–±—É–≤—å"},{value:"–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",label:"üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"},{value:"–î–µ—Ç—Å–∫–∞—è",label:"üë∂ –î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞"}],"–£—Å–ª—É–≥–∏":[{value:"–†–µ–º–æ–Ω—Ç",label:"üîß –†–µ–º–æ–Ω—Ç"},{value:"–ö—Ä–∞—Å–æ—Ç–∞",label:"üíá –ö—Ä–∞—Å–æ—Ç–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ"},{value:"–û–±—É—á–µ–Ω–∏–µ",label:"üìñ –û–±—É—á–µ–Ω–∏–µ"},{value:"–£–±–æ—Ä–∫–∞",label:"üßπ –£–±–æ—Ä–∫–∞"},{value:"–ü–µ—Ä–µ–≤–æ–∑–∫–∏",label:"üöö –ü–µ—Ä–µ–≤–æ–∑–∫–∏"},{value:"–î—Ä—É–≥–∏–µ",label:"‚öôÔ∏è –î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏"}]},d={"–õ–µ–≥–∫–æ–≤—ã–µ":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–ì—Ä—É–∑–æ–≤–∏–∫–∏":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–ú–æ—Ç–æ—Ü–∏–∫–ª—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–°–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞":[{value:"–ù–æ–≤–∞—è",label:"‚ú® –ù–æ–≤–∞—è"},{value:"–°_–ø—Ä–æ–±–µ–≥–æ–º",label:"üîÑ –° –ø—Ä–æ–±–µ–≥–æ–º"}],"–¢–µ–ª–µ—Ñ–æ–Ω—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ö–∞–∫_–Ω–æ–≤—ã–π",label:"‚≠ê –ö–∞–∫ –Ω–æ–≤—ã–π"},{value:"–•–æ—Ä–æ—à–µ–µ",label:"üëç –•–æ—Ä–æ—à–µ–µ"},{value:"–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ",label:"üì¶ –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ"}],"–ù–æ—É—Ç–±—É–∫–∏":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ë/–£_–æ—Ç–ª–∏—á–Ω–æ–µ",label:"‚≠ê –ë/–£ –æ—Ç–ª–∏—á–Ω–æ–µ"},{value:"–ë/–£_—Ö–æ—Ä–æ—à–µ–µ",label:"üëç –ë/–£ —Ö–æ—Ä–æ—à–µ–µ"}],"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã":[{value:"–ù–æ–≤—ã–π",label:"‚ú® –ù–æ–≤—ã–π"},{value:"–ë/–£_–æ—Ç–ª–∏—á–Ω–æ–µ",label:"‚≠ê –ë/–£ –æ—Ç–ª–∏—á–Ω–æ–µ"},{value:"–ë/–£_—Ö–æ—Ä–æ—à–µ–µ",label:"üëç –ë/–£ —Ö–æ—Ä–æ—à–µ–µ"}]},c=new Set(["–†–∞–±–æ—Ç–∞"]),u=new Set(["–ò—â—É_—Ä–∞–±–æ—Ç—É","–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞","–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞"]),h={"–ò—â—É_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞":{title:"üíº –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞–∫–∞–Ω—Å–∏–∏",fields:[{id:"company_sphere",label:"–°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ñ–µ—Ä—É",disabled:!0},{value:"IT",label:"üíª IT –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞"},{value:"–¢–æ—Ä–≥–æ–≤–ª—è",label:"üõí –¢–æ—Ä–≥–æ–≤–ª—è –∏ –ø—Ä–æ–¥–∞–∂–∏"},{value:"–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",label:"üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"},{value:"–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ",label:"üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"},{value:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",label:"üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},{value:"–ú–µ–¥–∏—Ü–∏–Ω–∞",label:"‚öïÔ∏è –ú–µ–¥–∏—Ü–∏–Ω–∞"},{value:"–§–∏–Ω–∞–Ω—Å—ã",label:"üí∞ –§–∏–Ω–∞–Ω—Å—ã –∏ –±–∞–Ω–∫–∏"},{value:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",label:"üìä –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞"},{value:"–õ–æ–≥–∏—Å—Ç–∏–∫–∞",label:"üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"},{value:"HoReCa",label:"üçΩÔ∏è HoReCa"},{value:"–î—Ä—É–≥–æ–µ",label:"üì¶ –î—Ä—É–≥–æ–µ"}]},{id:"work_schedule",label:"–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ü–æ–ª–Ω—ã–π_–¥–µ–Ω—å",label:"üïê –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å (5/2)"},{value:"–°–º–µ–Ω–Ω—ã–π",label:"üîÑ –°–º–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–£–¥–∞–ª–µ–Ω–Ω–∞—è",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–í–∞—Ö—Ç–∞",label:"üèóÔ∏è –í–∞—Ö—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥"},{value:"–ß–∞—Å—Ç–∏—á–Ω–∞—è",label:"‚è±Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å"}]},{id:"employment_type",label:"–£—Å–ª–æ–≤–∏—è –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",disabled:!0},{value:"–¢—Ä—É–¥–æ–≤–æ–π_–¥–æ–≥–æ–≤–æ—Ä",label:"üìã –¢—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä"},{value:"–ì–ü–•_–ò–ü",label:"üíº –î–æ–≥–æ–≤–æ—Ä –ì–ü–• —Å –ò–ü"},{value:"–ì–ü–•_–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π",label:"üìù –î–æ–≥–æ–≤–æ—Ä –ì–ü–• —Å —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–º"},{value:"–ë–µ–∑_–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",label:"ü§ù –ë–µ–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è"},{value:"–ü–æ_–¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏",label:"üí¨ –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏"}]},{id:"salary_from",label:"–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"50000",min:0},{id:"salary_to",label:"–ó–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"80000",min:0}]},"–ò—â—É_—Ä–∞–±–æ—Ç—É":{title:"üíº –û —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ",fields:[{id:"desired_position",label:"–ñ–µ–ª–∞–µ–º–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"},{id:"experience_years",label:"–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—ã—Ç",disabled:!0},{value:"–ë–µ–∑_–æ–ø—ã—Ç–∞",label:"üå± –ë–µ–∑ –æ–ø—ã—Ç–∞"},{value:"–î–æ_1_–≥–æ–¥–∞",label:"üìÖ –î–æ 1 –≥–æ–¥–∞"},{value:"1-3_–≥–æ–¥–∞",label:"üìä 1-3 –≥–æ–¥–∞"},{value:"3-5_–ª–µ—Ç",label:"‚≠ê 3-5 –ª–µ—Ç"},{value:"–ë–æ–ª–µ–µ_5_–ª–µ—Ç",label:"üèÜ –ë–æ–ª–µ–µ 5 –ª–µ—Ç"}]},{id:"desired_schedule",label:"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –≥—Ä–∞—Ñ–∏–∫",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ü–æ–ª–Ω—ã–π_–¥–µ–Ω—å",label:"üïê –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å"},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–£–¥–∞–ª–µ–Ω–Ω–∞—è",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–ß–∞—Å—Ç–∏—á–Ω–∞—è",label:"‚è±Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å"},{value:"–õ—é–±–æ–π",label:"‚ú® –õ—é–±–æ–π"}]},{id:"desired_salary_from",label:"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"50000",min:0},{id:"desired_salary_to",label:"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"100000",min:0}]},"–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞":{title:"‚è∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–µ",fields:[{id:"work_type",label:"–¢–∏–ø —Ä–∞–±–æ—Ç—ã",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø",disabled:!0},{value:"–†–∞–∑–æ–≤–∞—è",label:"üìÖ –†–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–†–µ–≥—É–ª—è—Ä–Ω–∞—è",label:"üîÑ –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞"},{value:"–ü—Ä–æ–µ–∫—Ç–Ω–∞—è",label:"üìã –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},{value:"–í–µ—á–µ—Ä–∞_–≤—ã—Ö–æ–¥–Ω—ã–µ",label:"üåô –í–µ—á–µ—Ä–∞/–≤—ã—Ö–æ–¥–Ω—ã–µ"}]},{id:"work_schedule",label:"–ì—Ä–∞—Ñ–∏–∫",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫",disabled:!0},{value:"–ì–∏–±–∫–∏–π",label:"‚è∞ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫"},{value:"–í–µ—á–µ—Ä–∞",label:"üåô –í–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è"},{value:"–í—ã—Ö–æ–¥–Ω—ã–µ",label:"üìÖ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏"},{value:"–£–¥–∞–ª–µ–Ω–Ω–æ",label:"üè† –£–¥–∞–ª–µ–Ω–Ω–æ"}]},{id:"payment_from",label:"–û–ø–ª–∞—Ç–∞ –æ—Ç",type:"number",required:!1,placeholder:"5000",min:0},{id:"payment_to",label:"–û–ø–ª–∞—Ç–∞ –¥–æ",type:"number",required:!1,placeholder:"15000",min:0}]},"–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞":{title:"üéì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–µ",fields:[{id:"internship_duration",label:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",disabled:!0},{value:"1_–º–µ—Å—è—Ü",label:"üìÖ 1 –º–µ—Å—è—Ü"},{value:"2_–º–µ—Å—è—Ü–∞",label:"üìÖ 2 –º–µ—Å—è—Ü–∞"},{value:"3_–º–µ—Å—è—Ü–∞",label:"üìÖ 3 –º–µ—Å—è—Ü–∞"},{value:"6_–º–µ—Å—è—Ü–µ–≤",label:"üìÖ 6 –º–µ—Å—è—Ü–µ–≤"},{value:"–ù–µ_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",label:"‚ùì –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"}]},{id:"internship_type",label:"–¢–∏–ø —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏",type:"select",required:!0,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø",disabled:!0},{value:"–û–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è",label:"üí∞ –û–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è"},{value:"–ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è",label:"üéì –ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞—è"},{value:"–°_–ø–æ—Å–ª–µ–¥—É—é—â–∏–º_—Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º",label:"‚úÖ –° –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º"}]},{id:"stipend_amount",label:"–†–∞–∑–º–µ—Ä —Å—Ç–∏–ø–µ–Ω–¥–∏–∏/–æ–ø–ª–∞—Ç—ã",type:"number",required:!1,placeholder:"20000",min:0}]},"–õ–µ–≥–∫–æ–≤—ã–µ":{title:"üöó –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è",fields:[{id:"car_brand",label:"–ú–∞—Ä–∫–∞",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Toyota"},{id:"car_model",label:"–ú–æ–¥–µ–ª—å",type:"text",required:!0,placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: Camry"},{id:"car_year",label:"–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞",type:"number",required:!0,placeholder:"2020",min:1950,max:(new Date).getFullYear()+1},{id:"car_mileage",label:"–ü—Ä–æ–±–µ–≥ (–∫–º)",type:"number",required:!1,placeholder:"50000",condition:"–°_–ø—Ä–æ–±–µ–≥–æ–º"},{id:"car_engine",label:"–û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ª)",type:"text",required:!1,placeholder:"2.0"},{id:"car_transmission",label:"–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ –ö–ü–ü",disabled:!0},{value:"–ú–ö–ü–ü",label:"‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è"},{value:"–ê–ö–ü–ü",label:"üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è"},{value:"–†–æ–±–æ—Ç",label:"ü§ñ –†–æ–±–æ—Ç"},{value:"–í–∞—Ä–∏–∞—Ç–æ—Ä",label:"‚ö° –í–∞—Ä–∏–∞—Ç–æ—Ä"}]}]},"–¢–µ–ª–µ—Ñ–æ–Ω—ã":{title:"üì± –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",fields:[{id:"phone_brand",label:"–ë—Ä–µ–Ω–¥",type:"text",required:!0,placeholder:"Apple, Samsung..."},{id:"phone_model",label:"–ú–æ–¥–µ–ª—å",type:"text",required:!0,placeholder:"iPhone 14 Pro"},{id:"phone_memory",label:"–ü–∞–º—è—Ç—å",type:"select",required:!1,options:[{value:"",label:"–í—ã–±–µ—Ä–∏—Ç–µ",disabled:!0},{value:"64GB",label:"64 –ì–ë"},{value:"128GB",label:"128 –ì–ë"},{value:"256GB",label:"256 –ì–ë"},{value:"512GB",label:"512 –ì–ë"},{value:"1TB",label:"1 –¢–ë"}]}]}};function p(e,t){return!c.has(e)&&(!t||!u.has(t))}const m={async create(){const e=i.getState(),{formData:t,photos:s}=e;let a;p(t.category,t.subcategory)&&(a=t.negotiable?t.price?`${t.price} (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è");const n={category:t.category,subcategory:t.subcategory||void 0,ad_type:"–ü—Ä–æ–¥–∞–º",condition:t.condition||void 0,title:t.title.trim(),description:t.description.trim(),price:a,contact:t.contact.trim(),location:t.location?.address,dynamic_fields:t.dynamicFields,photos:s.map(e=>e.url),scheduled_time:t.scheduledTime||void 0},l=await o.post("/ads",n);return l.success&&l.data?{success:!0,adId:l.data.ad_id}:{success:!1,error:l.error||"Failed to create ad"}},async getUserAds(e=!0){const t=await o.get(`/ads?include_expired=${e}`);return t.success&&t.data?{success:!0,ads:t.data.ads}:{success:!1,error:t.error||"Failed to get ads"}},async deleteAd(e){const t=await o.delete(`/ads/${e}`);return t.success?{success:!0}:{success:!1,error:t.error||"Failed to delete ad"}},async renewAd(e){const t=await o.post(`/ads/${e}/renew`);return t.success?{success:!0}:{success:!1,error:t.error||"Failed to renew ad"}},collectFormDataForTelegram(){const e=i.getState(),{formData:t,photos:s}=e;let a=null;p(t.category,t.subcategory)&&(a=t.negotiable?t.price?`${t.price} (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è");const n={category:t.category,subcategory:t.subcategory,condition:t.condition,dynamicFields:t.dynamicFields,title:t.title.trim(),description:t.description.trim(),price:a,contact:t.contact.trim(),location:t.location?.address||null,locationLat:t.location?.lat||null,locationLon:t.location?.lng||null,negotiable:t.negotiable,photos:s.map(e=>e.url),photoCount:s.length,scheduledTime:t.scheduledTime||"now",timestamp:Date.now()};return JSON.stringify(n)}},g={required(e){const t=e.trim().length>0;return{valid:t,message:t?void 0:"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ"}},minLength(e,t){const s=e.trim().length>=t;return{valid:s,message:s?void 0:`–ú–∏–Ω–∏–º—É–º ${t} —Å–∏–º–≤–æ–ª–æ–≤`}},maxLength(e,t){const s=e.length<=t;return{valid:s,message:s?void 0:`–ú–∞–∫—Å–∏–º—É–º ${t} —Å–∏–º–≤–æ–ª–æ–≤`}},title(e){const t=e.trim();return t.length<n.minTitleLength?{valid:!1,message:`–ú–∏–Ω–∏–º—É–º ${n.minTitleLength} —Å–∏–º–≤–æ–ª–∞`}:t.length>n.maxTitleLength?{valid:!1,message:`–ú–∞–∫—Å–∏–º—É–º ${n.maxTitleLength} —Å–∏–º–≤–æ–ª–æ–≤`}:{valid:!0}},description(e){const t=e.trim();return t.length<n.minDescLength?{valid:!1,message:`–ú–∏–Ω–∏–º—É–º ${n.minDescLength} —Å–∏–º–≤–æ–ª–æ–≤`}:t.length>n.maxDescLength?{valid:!1,message:`–ú–∞–∫—Å–∏–º—É–º ${n.maxDescLength} —Å–∏–º–≤–æ–ª–æ–≤`}:{valid:!0}},contact(e){const t=e.trim();if(!t)return{valid:!1,message:"–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ –Ω–æ–º–µ—Ä"};if(t.startsWith("@")){return/^@[a-zA-Z][a-zA-Z0-9_]{4,31}$/.test(t)?{valid:!0,type:"username",message:"Telegram username ‚úì"}:{valid:!1,type:"username",message:"Username: 5-32 —Å–∏–º–≤–æ–ª–∞ –ø–æ—Å–ª–µ @"}}const s=t.replace(/\D/g,"");return s.length>=10&&s.length<=15?{valid:!0,type:"phone",message:"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚úì"}:s.length>0&&s.length<10?{valid:!1,type:"phone",message:"–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"}:{valid:!1,message:"–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ –Ω–æ–º–µ—Ä"}},select:e=>({valid:!!e,message:e?void 0:"–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ"}),scheduledTime(e,t){if(!e||!t)return{valid:!0};try{return new Date(`${e}T${t}`)<=new Date?{valid:!1,message:"–í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º"}:{valid:!0}}catch{return{valid:!1,message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è"}}}};function b(e,t){e&&(e.classList.remove("is-success","is-error"),t&&e.classList.add(`is-${t}`))}function v(e,t,s){if(!e)return;e.textContent=`${t}/${s}`,e.classList.remove("is-warning","is-danger");const i=t/s;i>=.95?e.classList.add("is-danger"):i>=.8&&e.classList.add("is-warning")}function y(e){return document.getElementById(e)}function f(e,...t){e?.classList.add(...t)}function w(e,...t){e?.classList.remove(...t)}function C(e,t){e&&(e.style.display=t)}function S(e){C(e,"")}function T(e){C(e,"none")}function L(e,t){e&&(e.innerHTML=t)}function A(e,t){e&&(e.textContent=t)}function _(e){return e?.value??""}function $(e,t){e&&(e.value=t)}const D=new class{constructor(){t(this,"elements",{})}init(){this.cacheElements(),this.setupEventListeners(),this.prefillContact()}cacheElements(){["category","subcategory","condition","title","description","price","contact","location","negotiable","scheduleToggle","scheduleDate","scheduleTime","titleCounter","descCounter","categoryGroup","subcategoryGroup","conditionGroup","titleGroup","descriptionGroup","contactGroup","subcategoryWrapper","conditionWrapper","dynamicFieldsContainer","priceCard","scheduleFieldsContainer","contactType","contactError","progressFill","progressText"].forEach(e=>{this.elements[e]=y(e)})}setupEventListeners(){const{elements:e}=this;e.category?.addEventListener("change",()=>this.handleCategoryChange()),e.subcategory?.addEventListener("change",()=>this.handleSubcategoryChange()),e.condition?.addEventListener("change",()=>this.handleConditionChange()),e.title?.addEventListener("input",()=>this.handleTitleInput()),e.description?.addEventListener("input",()=>this.handleDescriptionInput()),e.contact?.addEventListener("input",()=>this.handleContactInput()),e.price?.addEventListener("input",()=>this.updateProgress()),e.negotiable?.addEventListener("change",()=>{a.haptic("light"),this.updateProgress()}),e.scheduleToggle?.addEventListener("change",()=>this.handleScheduleToggle()),e.scheduleDate?.addEventListener("change",()=>this.updateScheduleHint()),e.scheduleTime?.addEventListener("change",()=>this.updateScheduleHint()),document.querySelectorAll(".input, .textarea, .select").forEach(e=>{e.addEventListener("focus",()=>a.haptic("light"))})}prefillContact(){const e=a.user;e?.username&&this.elements.contact&&($(this.elements.contact,`@${e.username}`),this.handleContactInput())}handleCategoryChange(){const e=this.elements.category,t=_(e);if(!t)return;i.updateFormData({category:t,subcategory:null,condition:null}),i.clearDynamicFields(),w(e,"placeholder"),b(this.elements.categoryGroup,"success"),a.haptic("light");const s=this.elements.subcategory;s&&(s.value="",f(s,"placeholder")),b(this.elements.subcategoryGroup,null);const n=this.elements.condition;n&&(n.value="",f(n,"placeholder")),b(this.elements.conditionGroup,null),this.hideDynamicFields(),this.hideCondition(),r[t]?this.showSubcategories(t):this.hideSubcategories(),this.updatePriceCardVisibility(),this.updateProgress()}showSubcategories(e){const t=this.elements.subcategoryWrapper,s=this.elements.subcategory;if(!t||!s)return;const a=r[e];i.setCurrentSubcategories(a),s.innerHTML='<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>',a.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,s.appendChild(t)}),w(t,"hiding"),requestAnimationFrame(()=>f(t,"visible"))}hideSubcategories(){const e=this.elements.subcategoryWrapper;e?.classList.contains("visible")&&(f(e,"hiding"),setTimeout(()=>{w(e,"visible","hiding"),i.setCurrentSubcategories(null)},200))}handleSubcategoryChange(){const e=this.elements.subcategory,t=_(e);if(!t)return b(this.elements.subcategoryGroup,null),this.hideCondition(),this.hideDynamicFields(),void this.updatePriceCardVisibility();if(i.updateFormData({subcategory:t,condition:null}),w(e,"placeholder"),b(this.elements.subcategoryGroup,"success"),a.haptic("light"),d[t])this.showConditions(t);else{this.hideCondition();const e=this.elements.condition;e&&(e.value="")}h[t]?this.showDynamicFields(t):this.hideDynamicFields(),this.updatePriceCardVisibility(),this.updateProgress()}showConditions(e){const t=this.elements.conditionWrapper,s=this.elements.condition;if(!t||!s)return;const a=d[e];i.setCurrentConditions(a),s.innerHTML='<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</option>',a.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,s.appendChild(t)}),w(t,"hiding"),requestAnimationFrame(()=>f(t,"visible"))}hideCondition(){const e=this.elements.conditionWrapper;e?.classList.contains("visible")&&(f(e,"hiding"),setTimeout(()=>{w(e,"visible","hiding"),i.setCurrentConditions(null)},200))}handleConditionChange(){const e=this.elements.condition,t=_(e);t?(i.updateFormData({condition:t}),w(e,"placeholder"),b(this.elements.conditionGroup,"success"),a.haptic("light"),this.updateConditionalFields()):b(this.elements.conditionGroup,null),this.updateProgress()}showDynamicFields(e){this.hideDynamicFields();const t=h[e];if(!t)return;i.setCurrentDynamicFields(t);const s=this.elements.dynamicFieldsContainer;if(!s)return;let n=`\n      <article class="card dynamic-section" id="dynamicFieldsCard">\n        <header class="card-header">\n          <h2 class="card-title">${t.title}</h2>\n        </header>\n        <div class="card-body">\n    `;t.fields.forEach(e=>{const t=`dynamic_${e.id}`,s=!!e.condition;if(n+=`\n        <div class="form-group ${s?"conditional-field":""}"\n             id="${t}Group"\n             ${s?`data-condition="${e.condition}"`:""}\n             style="${s?"display: none;":""}">\n          <label class="form-label" for="${t}">\n            ${e.label}\n            <span class="badge ${e.required?"badge--required":"badge--optional"}">\n              ${e.required?"–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ":"–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ"}\n            </span>\n          </label>\n      `,"select"===e.type&&e.options)n+=`<select class="select placeholder" id="${t}" name="${t}" ${e.required?"required":""}>`,e.options.forEach(e=>{n+=`<option value="${e.value}" ${e.disabled?"disabled selected":""}>${e.label}</option>`}),n+="</select>";else if("textarea"===e.type)n+=`<textarea class="textarea" id="${t}" name="${t}" placeholder="${e.placeholder||""}" ${e.required?"required":""}></textarea>`;else{const s=[`type="${e.type}"`,`id="${t}"`,`name="${t}"`,`placeholder="${e.placeholder||""}"`,void 0!==e.min?`min="${e.min}"`:"",void 0!==e.max?`max="${e.max}"`:"",e.required?"required":""].filter(Boolean).join(" ");n+=`<input class="input" ${s}>`}e.required&&(n+='<p class="error-message">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –ø–æ–ª–µ</p>'),n+="</div>"}),n+="</div></article>",s.innerHTML=n,t.fields.forEach(e=>{const t=y(`dynamic_${e.id}`);t&&(t.addEventListener("input",t=>this.handleDynamicFieldInput(t,e)),t.addEventListener("change",t=>this.handleDynamicFieldInput(t,e)),t.addEventListener("focus",()=>a.haptic("light")))});const o=y("dynamicFieldsCard");requestAnimationFrame(()=>o?.classList.add("visible")),this.updateConditionalFields()}hideDynamicFields(){const e=y("dynamicFieldsCard");e&&(e.classList.add("hiding"),setTimeout(()=>{e.remove(),i.setCurrentDynamicFields(null),i.clearDynamicFields()},300))}handleDynamicFieldInput(e,t){const s=e.target;i.setDynamicField(t.id,s.value);const n=y(`dynamic_${t.id}Group`);t.required&&b(n,s.value.trim()?"success":null),"SELECT"===s.tagName&&s.value&&w(s,"placeholder"),this.updateProgress(),a.haptic("light")}updateConditionalFields(){const e=i.getState().formData.condition;document.querySelectorAll(".conditional-field").forEach(t=>{const s=t,i=s.dataset.condition;if(!i)return;const a=e===i;if(s.style.display=a?"block":"none",!a){const e=s.querySelector(".input, .select, .textarea");e&&(e.value="")}})}handleTitleInput(){const e=_(this.elements.title);i.updateFormData({title:e}),v(this.elements.titleCounter,e.length,n.maxTitleLength);const t=g.title(e);b(this.elements.titleGroup,t.valid?"success":null),this.updateProgress()}handleDescriptionInput(){const e=_(this.elements.description);i.updateFormData({description:e}),v(this.elements.descCounter,e.length,n.maxDescLength);const t=g.description(e);b(this.elements.descriptionGroup,t.valid?"success":null),this.updateProgress()}handleContactInput(){const e=_(this.elements.contact);i.updateFormData({contact:e});const t=g.contact(e),s=this.elements.contactType,a=this.elements.contactError;s&&s.classList.remove("is-visible"),b(this.elements.contactGroup,null),t.valid?(s&&(s.textContent=t.message||"",s.classList.add("is-visible")),b(this.elements.contactGroup,"success")):e.trim()&&a&&(a.textContent=t.message||""),this.updateProgress()}handleScheduleToggle(){const e=this.elements.scheduleToggle,t=this.elements.scheduleFieldsContainer;t&&(t.style.display=e?.checked?"block":"none"),e?.checked?this.updateScheduleHint():i.updateFormData({scheduledTime:null}),a.haptic("light")}updateScheduleHint(){const e=this.elements.scheduleToggle,t=this.elements.scheduleDate,s=this.elements.scheduleTime,a=y("scheduleHint");if(!e?.checked||!a)return;const n=_(t),o=_(s);if(n&&o)try{const e=new Date(`${n}T${o}`),t=new Date;if(e<=t)a.textContent="‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –±—É–¥—É—â–µ–µ –≤—Ä–µ–º—è",a.style.color="var(--color-warning)",i.updateFormData({scheduledTime:null});else{i.updateFormData({scheduledTime:`${n}T${o}:00`});const s=Math.floor((e.getTime()-t.getTime())/36e5),l=Math.floor(s/24);let r;if(l>0){r=`–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ${l} ${1===l?"–¥–µ–Ω—å":l<5?"–¥–Ω—è":"–¥–Ω–µ–π"}`}else if(s>0){r=`–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ${s} ${1===s?"—á–∞—Å":s<5?"—á–∞—Å–∞":"—á–∞—Å–æ–≤"}`}else r="–ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –º–µ–Ω–µ–µ —á–∞—Å–∞";a.textContent=r,a.style.color="var(--tg-hint)"}}catch{a.textContent="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è",a.style.color="var(--tg-hint)"}}updatePriceCardVisibility(){const e=i.getState(),t=this.elements.priceCard;if(!t)return;const s=p(e.formData.category,e.formData.subcategory);if(t.style.display=s?"block":"none",!s){i.updateFormData({price:"",negotiable:!1});const e=this.elements.price,t=this.elements.negotiable;e&&(e.value=""),t&&(t.checked=!1)}}updateProgress(){const e=i.getState(),{formData:t}=e;let s=0,a=0;a++,t.category&&s++,e.currentSubcategories&&(a++,t.subcategory&&s++),e.currentConditions&&(a++,t.condition&&s++),e.currentDynamicFields&&e.currentDynamicFields.fields.forEach(e=>{e.required&&(e.condition&&t.condition!==e.condition||(a++,t.dynamicFields[e.id]?.trim()&&s++))}),a++,g.title(t.title).valid&&s++,a++,g.description(t.description).valid&&s++,a++,g.contact(t.contact).valid&&s++;const n=a>0?Math.round(s/a*100):0,o=s===a&&a>0,l=this.elements.progressFill,r=this.elements.progressText;return l&&(l.style.width=`${n}%`,l.classList.remove("low","medium","high","complete"),o?l.classList.add("complete"):n>=70?l.classList.add("high"):n>=40?l.classList.add("medium"):l.classList.add("low")),r&&(r.textContent=`${n}%`,r.classList.toggle("complete",o)),this.updateMainButton(o,n),n}updateMainButton(e,t){const s=i.getState();"form"===s.currentView&&(s.uploadingCount>0?a.updateMainButton({text:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...",enabled:!1}):e?a.updateMainButton({text:"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí",enabled:!0,color:a.themeParams.button_color||"#007aff"}):a.updateMainButton({text:"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É",enabled:!1,color:"#8e8e93"}))}validate(){const e=i.getState(),{formData:t}=e,s=[];[this.elements.categoryGroup,this.elements.subcategoryGroup,this.elements.conditionGroup,this.elements.titleGroup,this.elements.descriptionGroup,this.elements.contactGroup].forEach(e=>b(e,null)),t.category||(b(this.elements.categoryGroup,"error"),s.push("‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è")),e.currentSubcategories&&!t.subcategory&&(b(this.elements.subcategoryGroup,"error"),s.push("‚Ä¢ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è")),e.currentConditions&&!t.condition&&(b(this.elements.conditionGroup,"error"),s.push("‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ")),e.currentDynamicFields&&e.currentDynamicFields.fields.forEach(e=>{e.required&&(e.condition&&t.condition!==e.condition||t.dynamicFields[e.id]?.trim()||(b(y(`dynamic_${e.id}Group`),"error"),s.push(`‚Ä¢ ${e.label}`)))}),g.title(t.title).valid||(b(this.elements.titleGroup,"error"),s.push("‚Ä¢ –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)")),g.description(t.description).valid||(b(this.elements.descriptionGroup,"error"),s.push("‚Ä¢ –û–ø–∏—Å–∞–Ω–∏–µ (–º–∏–Ω. 10 —Å–∏–º–≤–æ–ª–æ–≤)"));const a=g.contact(t.contact);if(!a.valid){const e=this.elements.contactError;e&&(e.textContent=a.message||""),b(this.elements.contactGroup,"error"),s.push("‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏")}const n=this.elements.scheduleToggle;if(n?.checked){const e=this.elements.scheduleDate,t=this.elements.scheduleTime;g.scheduledTime(_(e),_(t)).valid||s.push("‚Ä¢ –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º")}return{valid:0===s.length,errors:s}}syncToStore(){const e=this.elements.price,t=this.elements.negotiable;i.updateFormData({price:_(e),negotiable:t?.checked||!1})}},x={async upload(e){const t=await this.fileToBase64(e),s=await o.post("/photos/upload",{image:t,filename:e.name});return s.success&&s.data?s.data:{success:!1,error:s.error||"Upload failed"}},async uploadWithRetry(e,t=n.uploadRetryCount){for(let s=0;s<=t;s++){const i=await this.upload(e);if(i.success)return i;s<t&&await this.delay(n.uploadRetryDelay*(s+1))}return{success:!1,error:"Upload failed after retries"}},fileToBase64:e=>new Promise((t,s)=>{const i=new FileReader;i.onload=()=>{const e=i.result,s=e.includes(",")?e.split(",")[1]:e;t(s)},i.onerror=s,i.readAsDataURL(e)}),delay:e=>new Promise(t=>setTimeout(t,e)),validateFile(e){if(!e.type.startsWith("image/"))return{valid:!1,error:"Not an image file"};if(e.size>n.maxFileSize)return{valid:!1,error:`File too large (max ${n.maxFileSize/1024/1024}MB)`};const t=i.getState();return t.photos.length+t.uploadingCount>=n.maxPhotos?{valid:!1,error:`Maximum ${n.maxPhotos} photos allowed`}:{valid:!0}}};const E=new class{constructor(){t(this,"uploadArea",null),t(this,"input",null),t(this,"grid",null),t(this,"status",null),t(this,"localUrls",new Set)}init(){this.uploadArea=y("photoUploadArea"),this.input=y("photoInput"),this.grid=y("photoPreviewGrid"),this.status=y("photoStatus"),this.setupEventListeners(),this.setupLottieInteraction()}setupLottieInteraction(){const e=this.uploadArea?.querySelector("lottie-player");e&&(this.uploadArea?.addEventListener("mouseenter",()=>{e.setSpeed&&e.setSpeed(1.5)}),this.uploadArea?.addEventListener("mouseleave",()=>{e.setSpeed&&e.setSpeed(1)}))}setupEventListeners(){this.uploadArea?.addEventListener("click",()=>{const e=i.getState();e.photos.length+e.uploadingCount<n.maxPhotos&&(this.input?.click(),a.haptic("light"))}),this.input?.addEventListener("change",e=>{const t=e.target.files;t?.length&&(this.handleFiles(t),this.input&&(this.input.value=""))}),this.uploadArea?.addEventListener("dragover",e=>{e.preventDefault(),f(this.uploadArea,"dragover")}),this.uploadArea?.addEventListener("dragleave",()=>{w(this.uploadArea,"dragover")}),this.uploadArea?.addEventListener("drop",e=>{e.preventDefault(),w(this.uploadArea,"dragover");const t=e.dataTransfer?.files;t?.length&&this.handleFiles(t)})}async handleFiles(e){for(const t of Array.from(e)){const e=i.getState();if(e.photos.length+e.uploadingCount>=n.maxPhotos){this.setStatus(`–ú–∞–∫—Å–∏–º—É–º ${n.maxPhotos} —Ñ–æ—Ç–æ`,"error"),a.haptic("error");break}const s=x.validateFile(t);s.valid?await this.uploadFile(t):(this.setStatus(s.error||"–û—à–∏–±–∫–∞","error"),a.haptic("error"))}}async uploadFile(e){const t=`temp_${Date.now()}_${Math.random().toString(36).slice(2)}`,s=URL.createObjectURL(e);this.localUrls.add(s),this.addPreview(t,s,!0),i.incrementUploading(),this.updateUploadArea(),D.updateProgress();try{this.setStatus("–ó–∞–≥—Ä—É–∑–∫–∞...","");const s=await x.uploadWithRetry(e);s.success&&s.url?(i.addPhoto({id:s.url,url:s.url,thumb:s.url}),this.updatePreview(t,s.url),this.setStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${i.getState().photos.length} –∏–∑ ${n.maxPhotos}`,"success"),a.haptic("success")):(this.removePreview(t),this.setStatus(s.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏","error"),a.haptic("error"))}catch(o){this.removePreview(t),this.setStatus(`–û—à–∏–±–∫–∞: ${o.message}`,"error"),a.haptic("error")}finally{i.decrementUploading(),URL.revokeObjectURL(s),this.localUrls.delete(s),this.updateUploadArea(),D.updateProgress()}}addPreview(e,t,s){if(!this.grid)return;const i=document.createElement("div");i.className="photo-preview-item"+(s?" uploading":""),i.dataset.id=e,i.innerHTML=`\n      <img src="${t}" alt="–§–æ—Ç–æ" loading="lazy">\n      ${s?'<div class="upload-spinner"></div>':`<button type="button" class="photo-remove-btn" data-id="${e}" aria-label="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>`}\n    `,this.grid.appendChild(i),s||this.attachRemoveHandler(i,e)}updatePreview(e,t){const s=this.grid?.querySelector(`[data-id="${e}"]`);s&&(s.classList.remove("uploading"),s.dataset.id=t,s.innerHTML=`\n      <img src="${t}" alt="–§–æ—Ç–æ" loading="lazy">\n      <button type="button" class="photo-remove-btn" data-id="${t}" aria-label="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>\n    `,this.attachRemoveHandler(s,t))}removePreview(e){this.grid?.querySelector(`[data-id="${e}"]`)?.remove()}attachRemoveHandler(e,t){const s=e.querySelector(".photo-remove-btn");s?.addEventListener("click",e=>{e.stopPropagation(),this.removePhoto(t)})}removePhoto(e){i.removePhoto(e),this.removePreview(e),this.updateUploadArea(),D.updateProgress();const t=i.getState().photos.length;this.setStatus(t>0?`${t} –∏–∑ ${n.maxPhotos} —Ñ–æ—Ç–æ`:"",""),a.haptic("light")}updateUploadArea(){if(!this.uploadArea)return;const e=i.getState(),t=e.photos.length+e.uploadingCount,s=this.uploadArea.querySelector(".upload-text");t>=n.maxPhotos?(s&&(s.textContent="–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ñ–æ—Ç–æ"),f(this.uploadArea,"has-photos")):t>0?(s&&(s.textContent="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ñ–æ—Ç–æ"),f(this.uploadArea,"has-photos")):(s&&(s.textContent="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ"),w(this.uploadArea,"has-photos")),this.uploadArea.classList.toggle("uploading",e.uploadingCount>0)}setStatus(e,t){this.status&&(A(this.status,e),this.status.className="photo-status"+(t?` ${t}`:""))}cleanup(){this.localUrls.forEach(e=>{try{URL.revokeObjectURL(e)}catch{}}),this.localUrls.clear()}};const F=new class{render(){const e=i.getState(),{formData:t,photos:s}=e;let a=t.category?`#${t.category.replace(/\s+/g,"_").replace(/[()]/g,"")}`:"";t.subcategory&&(a+=` #${t.subcategory}`),t.condition&&(a+=` #${t.condition}`),A(y("previewHashtags"),a),A(y("previewTitle"),t.title.trim()),A(y("previewDescription"),t.description.trim());let n="";if(p(t.category,t.subcategory)){let e;e=t.negotiable?t.price?`${t.price} ‚ÇΩ (—Ç–æ—Ä–≥)`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è":t.price?`${t.price} ‚ÇΩ`:"–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è",n+=this.infoItem("üí∞","–¶–µ–Ω–∞:",e)}if(e.currentDynamicFields&&(n+=this.renderDynamicFieldsInfo(e.currentDynamicFields,t)),t.location){let e=t.location.address;e+=` <a href="https://www.google.com/maps?q=${t.location.lat},${t.location.lng}" target="_blank" style="color: #64B5EF;">üó∫Ô∏è</a>`,n+=this.infoItem("üìç","–õ–æ–∫–∞—Ü–∏—è:",e)}if(n+=this.infoItem("üë§","–ö–æ–Ω—Ç–∞–∫—Ç:",t.contact.trim()),t.scheduledTime)try{const e=new Date(t.scheduledTime).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});n+=this.infoItem("‚è∞","–ü—É–±–ª–∏–∫–∞—Ü–∏—è:",e)}catch{}L(y("previewInfo"),n),this.renderPhotos(s)}infoItem(e,t,s){return`\n      <div class="message-info-item">\n        <span class="message-info-icon">${e}</span>\n        <span><span class="message-info-label">${t}</span> ${s}</span>\n      </div>\n    `}renderDynamicFieldsInfo(e,t){let s="";return e.fields.forEach(e=>{if(e.condition&&t.condition!==e.condition)return;const i=t.dynamicFields[e.id];if(!i?.trim())return;if(e.id.includes("salary_from")||e.id.includes("desired_salary_from")||e.id.includes("payment_from")){const a=e.id.replace("_from","_to"),n=t.dynamicFields[a],o=n?`${i} - ${n} ‚ÇΩ`:`–æ—Ç ${i} ‚ÇΩ`,l=e.id.includes("desired_salary")?"–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞":e.id.includes("payment")?"–û–ø–ª–∞—Ç–∞":"–ó–∞—Ä–ø–ª–∞—Ç–∞";return void(s+=this.infoItem("üí∞",`${l}:`,o))}if(e.id.includes("_to")&&(e.id.includes("salary")||e.id.includes("payment")))return;const a=Object.entries({brand:"üè∑Ô∏è",model:"üè∑Ô∏è",year:"üìÖ",mileage:"üõ£Ô∏è",sphere:"üíº",position:"üíº",schedule:"‚è∞",experience:"‚≠ê",type:"üìù",employment:"üìù",duration:"‚è±Ô∏è"}).find(([t])=>e.id.toLowerCase().includes(t))?.[1]||"üìã";s+=this.infoItem(a,`${e.label}:`,i)}),s}renderPhotos(e){const t=y("previewPhotos");if(!t)return;if(0===e.length)return void T(t);const s=e.length;if(1===s)t.className="message-photos single-photo",L(t,`<div class="message-photo"><img src="${e[0].thumb}" alt="–§–æ—Ç–æ" loading="lazy"></div>`);else{t.className=`message-photos multiple-photos count-${s}`;L(t,e.map(e=>`<div class="message-photo"><img src="${e.thumb}" alt="–§–æ—Ç–æ" loading="lazy"></div>`).join(""))}var i,a;S(t),a={display:"grid"},(i=t)&&Object.assign(i.style,a)}};const P=new class{constructor(){t(this,"map",null),t(this,"selectedLocation",null)}init(){this.loadYandexMaps(),this.setupEventListeners()}loadYandexMaps(){const e=document.getElementById("yandex-maps");e&&!e.src&&(e.src=`https://api-maps.yandex.ru/2.1/?apikey=${n.yandexMapsKey}&lang=ru_RU`)}setupEventListeners(){y("location")?.addEventListener("click",()=>this.open()),y("location")?.addEventListener("focus",e=>{e.target.blur(),this.open()}),y("mapCloseBtn")?.addEventListener("click",()=>this.close()),y("mapCancelBtn")?.addEventListener("click",()=>this.close()),y("mapConfirmBtn")?.addEventListener("click",()=>this.confirm()),y("mapMyLocationBtn")?.addEventListener("click",()=>{a.haptic("light"),this.getUserLocation()})}open(){const e=y("mapModal");e&&(f(e,"active"),document.body.style.overflow="hidden",setTimeout(()=>this.initMap(),100),a.haptic("light"))}close(){const e=y("mapModal");e&&(w(e,"active"),document.body.style.overflow="",document.getElementById("centerMarker")?.remove(),this.map&&(this.map.destroy(),this.map=null),a.haptic("light"))}initMap(){this.map||"undefined"==typeof ymaps?"undefined"==typeof ymaps&&setTimeout(()=>this.initMap(),500):ymaps.ready(()=>{this.map=new ymaps.Map("locationMap",{center:n.defaultMapCenter,zoom:13,controls:[]});const e=document.createElement("div");let t;e.id="centerMarker",e.style.cssText="\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -100%);\n        z-index: 1000;\n        pointer-events: none;\n        font-size: 40px;\n        filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));\n      ",e.innerHTML="üìç",this.map.container.getParentElement().appendChild(e),this.map.events.add("boundschange",()=>{clearTimeout(t),t=setTimeout(()=>{const e=this.map.getCenter();this.updateAddress(e[0],e[1])},500)}),this.getUserLocation()})}getUserLocation(){if(!navigator.geolocation)return void this.updateAddress(n.defaultMapCenter[0],n.defaultMapCenter[1]);const e=y("mapAddress");e&&L(e,'<span class="map-address-loading">‚è≥ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</span>'),navigator.geolocation.getCurrentPosition(e=>{this.map&&(this.map.setCenter([e.coords.latitude,e.coords.longitude],15,{duration:300}),this.updateAddress(e.coords.latitude,e.coords.longitude)),a.haptic("success")},()=>{this.updateAddress(n.defaultMapCenter[0],n.defaultMapCenter[1])},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}async updateAddress(e,t){const s=y("mapAddress"),i=y("mapConfirmBtn");s&&L(s,'<span class="map-address-loading">üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞...</span>'),i&&(i.disabled=!0);try{const s=(await new Promise((s,i)=>{ymaps.geocode([e,t],{results:1}).then(s).catch(i)})).geoObjects.get(0);if(!s)throw new Error("Address not found");let i=s.getAddressLine().replace(/^–†–µ—Å–ø—É–±–ª–∏–∫–∞\s+[^,]+,\s*/i,"").replace(/^[–ê-–Ø–∞-—è\s]+–æ–±–ª–∞—Å—Ç—å,\s*/i,"").replace(/^[–ê-–Ø–∞-—è\s]+–∫—Ä–∞–π,\s*/i,"");this.selectedLocation={address:i||`${e.toFixed(4)}, ${t.toFixed(4)}`,lat:e,lng:t}}catch{this.selectedLocation={address:`${e.toFixed(4)}, ${t.toFixed(4)}`,lat:e,lng:t}}s&&L(s,`üìç ${this.selectedLocation.address}`),i&&(i.disabled=!1)}confirm(){if(!this.selectedLocation)return;i.setLocation(this.selectedLocation);const e=y("location"),t=y("locationHint");e&&($(e,this.selectedLocation.address),f(e,"location-selected")),t&&(t.textContent="‚úì –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ",f(t,"location-selected")),this.close(),a.haptic("success")}};const M=new class{constructor(){t(this,"header",null),t(this,"slotsIndicator",null),t(this,"slotsCount",null),t(this,"cooldownWarning",null),t(this,"cooldownTime",null),t(this,"progressSection",null),t(this,"lastScrollY",0)}init(){this.header=y("header"),this.slotsIndicator=y("slotsIndicator"),this.slotsCount=y("slotsCount"),this.cooldownWarning=y("cooldownWarning"),this.cooldownTime=y("cooldownTime"),this.progressSection=y("progressSection"),this.setupScrollListener(),this.update(),i.subscribe(()=>this.update())}setupScrollListener(){const e=function(e,t){let s=!1;return(...i)=>{s||(e(...i),s=!0,setTimeout(()=>s=!1,t))}}(()=>{if(!this.header)return;const e=window.scrollY;e>20?this.header.classList.contains("scrolled")||f(this.header,"scrolled"):this.header.classList.contains("scrolled")&&w(this.header,"scrolled"),this.lastScrollY=e},50);window.addEventListener("scroll",e,{passive:!0}),e()}update(){const e=i.getState(),t=e.userLimits;if(this.slotsIndicator&&this.slotsCount&&t){const e=t.availableSlots;A(this.slotsCount,`${e}/${t.maxSlots}`),w(this.slotsIndicator,"warning","full"),0===e?f(this.slotsIndicator,"full"):e<=2&&f(this.slotsIndicator,"warning")}if(this.cooldownWarning&&this.cooldownTime&&t)if(t.cooldownSeconds&&t.cooldownSeconds>0){const e=Math.floor(t.cooldownSeconds/3600),s=Math.floor(t.cooldownSeconds%3600/60);A(this.cooldownTime,e>0?`${e} —á ${s} –º–∏–Ω`:`${s} –º–∏–Ω`),f(this.cooldownWarning,"visible")}else w(this.cooldownWarning,"visible");this.progressSection&&("create"===e.currentTab?S(this.progressSection):T(this.progressSection))}setTitle(e,t){A(y("headerTitle"),e),A(y("headerSubtitle"),t)}};const q=new class{constructor(){t(this,"tabsContainer",null),t(this,"createTab",null),t(this,"myAdsTab",null),t(this,"onTabChange",null)}init(e){this.onTabChange=e,this.render(),this.cacheElements(),this.setupEventListeners(),i.subscribe(()=>this.updateActiveState())}render(){const e=y("header");if(!e)return;let t=y("tabsContainer");if(!t){t=document.createElement("div"),t.id="tabsContainer",t.className="tabs-container",t.innerHTML='\n        <button type="button" class="tab-button active" id="createTab" data-tab="create">\n          <span class="tab-icon">‚úèÔ∏è</span>\n          <span class="tab-text">–°–æ–∑–¥–∞—Ç—å</span>\n        </button>\n        <button type="button" class="tab-button" id="myAdsTab" data-tab="myads">\n          <span class="tab-icon">üìã</span>\n          <span class="tab-text">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</span>\n        </button>\n      ';const s=e.querySelector(".header-content");s&&s.appendChild(t)}this.tabsContainer=t}cacheElements(){this.createTab=y("createTab"),this.myAdsTab=y("myAdsTab")}setupEventListeners(){this.createTab?.addEventListener("click",()=>this.switchTab("create")),this.myAdsTab?.addEventListener("click",()=>this.switchTab("myads"))}switchTab(e){i.getState().currentTab!==e&&(a.haptic("light"),i.setCurrentTab(e),this.onTabChange&&this.onTabChange(e))}updateActiveState(){const{currentTab:e}=i.getState();this.createTab&&("create"===e?f(this.createTab,"active"):w(this.createTab,"active")),this.myAdsTab&&("myads"===e?f(this.myAdsTab,"active"):w(this.myAdsTab,"active"))}updateBadge(e){if(!this.myAdsTab)return;let t=this.myAdsTab.querySelector(".tab-badge");e>0?(t||(t=document.createElement("span"),t.className="tab-badge",this.myAdsTab.appendChild(t)),t.textContent=e>99?"99+":String(e)):t&&t.remove()}};const U=new class{constructor(){t(this,"container",null),t(this,"initialized",!1)}init(){this.initialized||(this.initialized=!0,this.render(),i.subscribe(()=>this.onStateChange()))}render(){let e=y("myAdsView");if(!e){e=document.createElement("div"),e.id="myAdsView",e.className="view my-ads-view",e.innerHTML='\n        <div class="container">\n          <div class="my-ads-header">\n            <h2 class="my-ads-title">üìã –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>\n            <button type="button" class="refresh-btn" id="refreshAdsBtn" title="–û–±–Ω–æ–≤–∏—Ç—å">\n              üîÑ\n            </button>\n          </div>\n          <div class="my-ads-content" id="myAdsContent">\n            <div class="my-ads-loading">\n              <div class="spinner"></div>\n              <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</p>\n            </div>\n          </div>\n        </div>\n      ';const t=y("app");t&&t.appendChild(e)}this.container=e,this.setupEventListeners()}setupEventListeners(){y("refreshAdsBtn")?.addEventListener("click",()=>{a.haptic("light"),this.loadAds()})}onStateChange(){"myads"===i.getState().currentTab?this.show():this.hide()}show(){this.container&&(f(this.container,"active"),S(this.container)),this.loadAds()}hide(){this.container&&(w(this.container,"active"),T(this.container))}async loadAds(){const e=y("myAdsContent");if(e){i.setUserAdsLoading(!0),i.setUserAdsError(null),L(e,'\n      <div class="my-ads-loading">\n        <div class="spinner"></div>\n        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</p>\n      </div>\n    ');try{const e=await m.getUserAds(!0);e.success&&e.ads?(i.setUserAds(e.ads),this.renderAds(e.ads)):(i.setUserAdsError(e.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),this.renderError(e.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π"))}catch(t){i.setUserAdsError(t.message),this.renderError(t.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")}finally{i.setUserAdsLoading(!1)}}}renderAds(e){const t=y("myAdsContent");if(!t)return;if(0===e.length)return void L(t,'\n        <div class="my-ads-empty">\n          <div class="empty-icon">üì≠</div>\n          <h3>–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h3>\n          <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.<br>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ!</p>\n        </div>\n      ');L(t,`<div class="my-ads-list">${e.map(e=>this.renderAdCard(e)).join("")}</div>`),this.setupAdActions()}renderAdCard(e){const t=this.getStatusInfo(e.status),s=e.photos?.[0],i=this.getTimeInfo(e);return`\n      <article class="my-ad-card" data-ad-id="${e.id}">\n        <div class="my-ad-card-inner">\n          ${s?`\n            <div class="my-ad-photo">\n              <img src="${s}" alt="${e.title}" loading="lazy">\n            </div>\n          `:'\n            <div class="my-ad-photo my-ad-photo--empty">\n              <span>üì∑</span>\n            </div>\n          '}\n          <div class="my-ad-info">\n            <div class="my-ad-status ${t.class}">\n              <span class="status-dot"></span>\n              ${t.text}\n            </div>\n            <h3 class="my-ad-title">${e.title}</h3>\n            <div class="my-ad-meta">\n              <span class="my-ad-category">${e.category}</span>\n              ${e.price?`<span class="my-ad-price">${e.price}</span>`:""}\n            </div>\n            ${i?`<div class="my-ad-time">${i}</div>`:""}\n          </div>\n        </div>\n        <div class="my-ad-actions">\n          ${this.renderAdActions(e)}\n        </div>\n      </article>\n    `}getStatusInfo(e){return{pending:{text:"‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏",class:"status--pending"},active:{text:"‚úÖ –ê–∫—Ç–∏–≤–Ω–æ",class:"status--active"},scheduled:{text:"üïê –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ",class:"status--scheduled"},expired:{text:"‚åõ –ò—Å—Ç–µ–∫–ª–æ",class:"status--expired"},rejected:{text:"‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ",class:"status--rejected"},deleted:{text:"üóë –£–¥–∞–ª–µ–Ω–æ",class:"status--deleted"}}[e]||{text:e,class:""}}getTimeInfo(e){if("active"===e.status&&e.expires_at){const t=new Date(e.expires_at),s=new Date,i=Math.ceil((t.getTime()-s.getTime())/864e5);if(i>0)return`‚è∞ –û—Å—Ç–∞–ª–æ—Å—å: ${i} –¥–Ω.`}if("scheduled"===e.status&&e.scheduled_time){const t=new Date(e.scheduled_time);return`üìÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è: ${t.toLocaleDateString("ru-RU")} ${t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`}if(e.created_at){return`üìÖ –°–æ–∑–¥–∞–Ω–æ: ${new Date(e.created_at).toLocaleDateString("ru-RU")}`}return""}renderAdActions(e){const t=[];return"expired"===e.status&&t.push(`\n        <button type="button" class="ad-action-btn ad-action-btn--primary" data-action="renew" data-ad-id="${e.id}">\n          üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å\n        </button>\n      `),["active","pending","scheduled"].includes(e.status)&&t.push(`\n        <button type="button" class="ad-action-btn ad-action-btn--danger" data-action="delete" data-ad-id="${e.id}">\n          üóë –£–¥–∞–ª–∏—Ç—å\n        </button>\n      `),0===t.length?'<span class="no-actions">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</span>':t.join("")}setupAdActions(){const e=y("myAdsContent");e&&e.querySelectorAll(".ad-action-btn").forEach(e=>{e.addEventListener("click",async e=>{const t=e.currentTarget,s=t.dataset.action,i=t.dataset.adId;s&&i&&(a.haptic("light"),"delete"===s?await this.handleDelete(i,t):"renew"===s&&await this.handleRenew(i,t))})})}async handleDelete(e,t){a.showConfirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?",async s=>{if(s){t.setAttribute("disabled","true"),t.textContent="‚è≥...";try{const s=await m.deleteAd(e);if(s.success){a.haptic("success"),i.removeUserAd(e);const s=t.closest(".my-ad-card");s&&(s.classList.add("removing"),setTimeout(()=>s.remove(),300)),setTimeout(()=>{0===i.getState().userAds.length&&this.renderAds([])},350)}else a.haptic("error"),a.showAlert(s.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è"),t.removeAttribute("disabled"),t.textContent="üóë –£–¥–∞–ª–∏—Ç—å"}catch(n){a.haptic("error"),a.showAlert(n.message||"–û—à–∏–±–∫–∞"),t.removeAttribute("disabled"),t.textContent="üóë –£–¥–∞–ª–∏—Ç—å"}}})}async handleRenew(e,t){t.setAttribute("disabled","true"),t.textContent="‚è≥...";try{const s=await m.renewAd(e);s.success?(a.haptic("success"),a.showAlert("‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–ª–µ–Ω–æ –Ω–∞ 30 –¥–Ω–µ–π!"),await this.loadAds()):(a.haptic("error"),a.showAlert(s.error||"–û—à–∏–±–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è"),t.removeAttribute("disabled"),t.textContent="üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å")}catch(s){a.haptic("error"),a.showAlert(s.message||"–û—à–∏–±–∫–∞"),t.removeAttribute("disabled"),t.textContent="üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å"}}renderError(e){const t=y("myAdsContent");t&&(L(t,`\n      <div class="my-ads-error">\n        <div class="error-icon">‚ö†Ô∏è</div>\n        <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>\n        <p>${e}</p>\n        <button type="button" class="retry-btn" id="retryLoadAds">\n          üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞\n        </button>\n      </div>\n    `),y("retryLoadAds")?.addEventListener("click",()=>{a.haptic("light"),this.loadAds()}))}};const k=new class{constructor(){t(this,"formView",null),t(this,"previewView",null),t(this,"lastClosingConfirmationState",null)}async init(){a.init(),this.formView=y("formView"),this.previewView=y("previewView"),M.init(),D.init(),E.init(),P.init(),U.init(),q.init(e=>this.handleTabChange(e)),this.setupNavigation(),this.initScheduleDate(),await this.authenticate(),this.setupMainButton(),this.setupClosingConfirmation()}async authenticate(){try{if(await l.authenticate()){await l.getUserLimits(),M.update();const e=await m.getUserAds(!1);if(e.success&&e.ads){const t=e.ads.filter(e=>["pending","active","scheduled"].includes(e.status)).length;q.updateBadge(t)}}else i.setUserLimits({activeSlots:0,maxSlots:5,availableSlots:5,cooldownSeconds:null,canPublish:!0,isAdmin:!1}),M.update()}catch(e){}}handleTabChange(e){"create"===e?this.showCreateTab():"myads"===e&&this.showMyAdsTab()}showCreateTab(){this.previewView?.classList.contains("active")&&(T(this.previewView),w(this.previewView,"active")),S(this.formView),f(this.formView,"active"),U.hide(),M.setTitle("–ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ","–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É"),this.setupMainButton(),D.updateProgress()}showMyAdsTab(){T(this.formView),w(this.formView,"active"),this.previewView&&(T(this.previewView),w(this.previewView,"active")),U.show(),M.setTitle("–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è","–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏"),a.updateMainButton({visible:!1})}setupMainButton(){"create"===i.getState().currentTab?(a.setupMainButton("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É",()=>{this.handleMainButtonClick()}),a.updateMainButton({enabled:!1,visible:!0,color:"#8e8e93"})):a.updateMainButton({visible:!1})}handleMainButtonClick(){"form"===i.getState().currentView?this.showPreview():this.submitAd()}setupNavigation(){y("backToFormBtn")?.addEventListener("click",()=>{this.showForm()}),y("submitBtn")?.addEventListener("click",()=>{this.submitAd()})}initScheduleDate(){const e=y("scheduleDate");if(!e)return;const t=new Date,s=new Date(t);s.setDate(s.getDate()+1),e.min=t.toISOString().split("T")[0],e.value=s.toISOString().split("T")[0]}showForm(){i.setCurrentView("form"),f(this.previewView,"slide-out-right"),setTimeout(()=>{T(this.previewView),w(this.previewView,"slide-out-right"),S(this.formView),f(this.formView,"active","slide-in-left"),setTimeout(()=>{w(this.formView,"slide-in-left")},300)},300),M.setTitle("–ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ","–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É"),a.setupMainButton("–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí",()=>this.showPreview()),D.updateProgress(),a.haptic("light")}showPreview(){D.syncToStore();const{valid:e,errors:t}=D.validate();if(!e)return a.haptic("error"),void a.showPopup("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ","–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n\n"+t.join("\n"));i.setCurrentView("preview"),F.render(),f(this.formView,"slide-out-left"),setTimeout(()=>{T(this.formView),w(this.formView,"slide-out-left","active"),S(this.previewView),f(this.previewView,"active","slide-in-right"),setTimeout(()=>{w(this.previewView,"slide-in-right")},300)},300),M.setTitle("–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä","–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"),a.setupMainButton("‚úì –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é",()=>this.submitAd()),a.updateMainButton({enabled:!0,color:a.themeParams.button_color||"#007aff"}),a.haptic("success")}async submitAd(){a.haptic("medium"),a.updateMainButton({progress:!0,enabled:!1});try{if(i.getState().isAuthenticated){if((await m.create()).success){a.haptic("success"),a.showAlert("‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!",()=>{i.resetForm(),i.setCurrentTab("myads"),this.handleTabChange("myads")});const e=i.getState().userLimits;return void(e&&q.updateBadge(e.activeSlots+1))}}const e=m.collectFormDataForTelegram();if(e.length>n.maxDataSize)throw new Error("–î–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ. –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ.");a.sendData(e)?a.haptic("success"):alert(`–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏\n\n–î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã: ${e.length} bytes`)}catch(e){a.haptic("error"),a.showPopup("–û—à–∏–±–∫–∞",e.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ")}finally{a.updateMainButton({progress:!1,enabled:!0})}}setupClosingConfirmation(){const e=()=>{const e=i.getState();if("create"!==e.currentTab)return void(!1!==this.lastClosingConfirmationState&&(this.lastClosingConfirmationState=!1,a.disableClosingConfirmation()));const t=!!(e.formData.category||e.formData.title.trim()||e.formData.description.trim()||e.formData.contact.trim()||e.photos.length>0);this.lastClosingConfirmationState!==t&&(this.lastClosingConfirmationState=t,t?a.enableClosingConfirmation():a.disableClosingConfirmation())};e(),i.subscribe(()=>{e()})}destroy(){E.cleanup()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>k.init()):k.init(),window.addEventListener("beforeunload",()=>{k.destroy()});
